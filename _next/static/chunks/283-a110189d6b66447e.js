"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[283],{283:(e,t,o)=>{o.a(e,async(e,n)=>{try{o.d(t,{A:()=>d});var a=o(5155),r=o(2115),s=o(4239),l=o(8020),c=o(4019),i=o(5799);o(5716);let e=await (0,s.VU)(),d=()=>{let[t,o]=(0,r.useState)([]),[n,d]=(0,r.useState)(!0),[u,g]=(0,r.useState)(""),[h,m]=(0,r.useState)(null),[p,f]=(0,r.useState)(null),[y,v]=(0,r.useState)([]),[x,w]=(0,r.useState)(JSON.parse(localStorage.getItem("attendanceTimers"))||{});(0,r.useEffect)(()=>{let e=JSON.parse(localStorage.getItem("attendanceTimers"))||{};w(e)},[]),(0,r.useEffect)(()=>{let e=e=>{Object.keys(x).length>0&&(e.preventDefault(),e.returnValue="Attendance is still running. Are you sure you want to leave?")};return window.addEventListener("beforeunload",e),()=>window.removeEventListener("beforeunload",e)},[x]),(0,r.useEffect)(()=>{let e=setInterval(()=>{if(!h)return;let e=Date.now();Object.entries(x).forEach(t=>{let[o,n]=t;if(e>=n){h.stopAttendance(o),i.oR.info("Attendance automatically stopped for ".concat(o));let e={...x};delete e[o],w(e),localStorage.setItem("attendanceTimers",JSON.stringify(e))}})},1e3);return()=>clearInterval(e)},[x,h]);let b=async()=>{try{d(!0);let e=await (0,s.pn)();o(e)}catch(e){g(e.message||"Failed to load classrooms")}finally{d(!1)}};return((0,r.useEffect)(()=>{b();let e=new s.s_({newMessageCallback:e=>console.log("New message:",e),connectionCallback:()=>console.log("Connected to socket"),successCallback:e=>console.log("Socket success:",e),errorCallback:e=>console.error("Socket error:",e),attendanceStartedCallback:e=>i.oR.success("Attendance started for ".concat(e.classroom_id||"")),punchInCallback:()=>i.oR.info("Punch-In recorded."),punchOutCallback:()=>i.oR.info("Punch-Out recorded.")});return m(e),()=>{e.socket.disconnect()}},[]),n)?(0,a.jsx)(l.A,{}):u?(0,a.jsx)("div",{className:"text-red-600",children:u}):(0,a.jsxs)("div",{className:"bg-gray-50 min-h-screen px-6 py-8",children:[(0,a.jsx)(i.ToastContainer,{}),(0,a.jsx)("h2",{className:"text-3xl font-bold text-center mb-8",children:"Classrooms"}),(0,a.jsx)("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6",children:t.map(t=>(0,a.jsxs)("div",{className:"bg-white border shadow-md rounded-2xl p-6",children:[(0,a.jsx)("h3",{className:"text-xl font-semibold text-center",children:t.name}),(0,a.jsxs)("div",{className:"flex flex-col gap-3 items-center mt-4",children:[(0,a.jsx)("button",{onClick:()=>{f(t._id),v(t.discussion)},className:"px-5 py-2.5 bg-purple-600 text-white rounded-lg hover:bg-purple-700",children:"Open Chat"}),"Teacher"===e.role&&(0,a.jsx)("button",{onClick:()=>(e=>{if(!h)return i.oR.error("Socket not initialized yet!");h.startAttendance(e,10),i.oR.success("Attendance started for 10 minutes!");let t=Date.now()+6e5,o={...x,[e]:t};w(o),localStorage.setItem("attendanceTimers",JSON.stringify(o))})(t._id),className:"px-5 py-2.5 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:"Start Attendance"}),x[t._id]&&(0,a.jsxs)("p",{className:"text-green-700 font-semibold",children:["Time Left:"," ",Math.max(0,Math.ceil((x[t._id]-Date.now())/1e3)),"s"]}),(0,a.jsxs)("div",{className:"flex gap-3 w-full",children:[(0,a.jsx)("button",{onClick:()=>{var e;return e=t._id,void(h&&navigator.geolocation.getCurrentPosition(t=>{h.punchIn({classroom_id:e,location:{lat:t.coords.latitude,long:t.coords.longitude}}),i.oR.success("Punch-In successful!")},()=>i.oR.error("Location not found")))},className:"w-1/2 bg-green-600 text-white py-2 rounded-lg",children:"Punch In"}),(0,a.jsx)("button",{onClick:()=>{var e;return e=t._id,void(h&&navigator.geolocation.getCurrentPosition(t=>{h.punchOut({classroom_id:e,location:{lat:t.coords.latitude,long:t.coords.longitude}}),i.oR.success("Punch-Out successful!")},()=>i.oR.error("Location not found")))},className:"w-1/2 bg-red-600 text-white py-2 rounded-lg",children:"Punch Out"})]})]})]},t._id))}),p&&(0,a.jsx)(c.A,{classroomId:p,socket:h,onClose:()=>f(null),existingMessages:y})]})};n()}catch(e){n(e)}},1)},2105:(e,t,o)=>{o.d(t,{A$:()=>u,AS:()=>a,DY:()=>r,In:()=>h,Pq:()=>b,QM:()=>d,VU:()=>v,Yq:()=>x,eg:()=>w,kQ:()=>c,lh:()=>l,pn:()=>i,s_:()=>y,xF:()=>m,zz:()=>s});var n=o(4298);let a="https://beginity-test.ddns.net";async function r(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e=>{console.log(e)},o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:e=>console.error(e);e.preventDefault();try{let o=await h("".concat(a,"/api/auth/register"),"POST",g(e.target,e.submitter));t(o)}catch(e){o(e)}}async function s(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e=>{console.log(e)},o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:e=>console.error(e);e.preventDefault();try{let o=await h("".concat(a,"/api/auth/login"),"POST",g(e.target,e.submitter));t(o),p("token",o.token,1296e6),p("user-login-detail",{...o.user},1296e6)}catch(e){o(e)}}async function l(e){var t;let o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e=>{console.log(e)},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:e=>console.error(e);e.preventDefault();let r=new FormData(e.target,e.submitter),s={mandatory:"on"===r.get("mandatory"),title:r.get("title"),description:{detail:r.get("detail"),objectives:r.get("objectives").split("\n"),learning_outcomes:r.get("learning_outcomes").split("\n")},start_time:new Date(r.get("start_time")).toISOString(),end_time:new Date(r.get("end_time")).toISOString(),location:{address:r.get("address"),lat:Number.parseFloat(r.get("lat"))||null,long:Number.parseFloat(r.get("long"))||null},speaker_ids:null==r||null==(t=r.get("speaker_ids"))?void 0:t.split(",").map(e=>e.trim())};console.group("createEvent"),console.log(JSON.stringify(s,null,2));try{let e=await m("".concat(a,"/api/events"),"POST",s);o(e)}catch(e){n(e)}finally{console.groupEnd()}}async function c(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;null==e||e.preventDefault();try{let e=await h("".concat(a,"/api/events/"),"GET",{});return console.log(e),e}catch(e){throw console.error(e),Error(e.message)}}async function i(e){e&&e.preventDefault();try{let e=await m("".concat(a,"/api/classrooms/"),"GET");return console.log(e),e}catch(e){throw Error(e.message)}}async function d(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e=>{console.log(e)},o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:e=>console.error(e);e.preventDefault();let n=new FormData(e.target,e.submitter);try{let e=f("token");if(!e)throw Error("Log in/ Register to Perform This action");let o=await fetch("".concat(a,"/file/upload/"),{method:"POST",headers:{Authorization:"Bearer ".concat(e)},body:n});if(!o.ok){let e=await o.json();throw Error(null==e?void 0:e.message)}let r=await o.json();return t(r),r}catch(e){return o(e),null}}async function u(e,t){let o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:e=>{console.log(e)},n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:e=>console.error(e);try{let n=await h("".concat(a,"/api/auth/otp"),"post",{email:e,purpose:t});return o(n),n}catch(e){return n(e),null}}function g(e,t){let o=new FormData(e,t),n={};for(let[e,t]of o.entries())n[e]=t;return n}async function h(e,t){let o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};try{let n={method:t,headers:{"Content-type":"application/json",Accept:"application/json"},body:JSON.stringify(o)};["GET","HEAD"].includes(t.toUpperCase())&&(n.body=void 0);let a=await fetch(e,n);if(!a.ok){let e=await a.json();throw console.dir(e),Error((null==e?void 0:e.message)||"Unknown Error!")}return await a.json()}catch(e){throw console.dir("Fetch request failed",e),e}}async function m(e,t,o){try{let n=f("token");if(!n)throw Error("Log in/ Register to Perform This action");let a={method:t,headers:{Authorization:"Bearer ".concat(n),"Content-type":"application/json",Accept:"application/json"},body:JSON.stringify(o)};["GET","HEAD"].includes(t.toUpperCase())&&(a.body=void 0);let r=await fetch(e,a);if(!r.ok){let e=await r.json();throw console.dir(e),Error((null==e?void 0:e.message)||"Unknown Error!")}return await r.json()}catch(e){throw console.log(e),e}}function p(e,t,o){let n={value:t,expiry:new Date().getTime()+o};localStorage.setItem(e,JSON.stringify(n))}function f(e){try{let t=localStorage.getItem(e);if(!t)return null;let o=JSON.parse(t);if(new Date().getTime()>o.expiry)return localStorage.removeItem(e),null;return o.value}catch(e){return console.warn("error",e),null}}r.handler=(e,t)=>o=>{r(o,e,t)},s.handler=(e,t)=>o=>{s(o,e,t)},l.handler=(e,t)=>o=>{l(o,e,t)},d.handler=(e,t)=>o=>{d(o,e,t)};class y{constructor({newMessageCallback:e,connectionCallback:t,successCallback:o,errorCallback:r,attendanceStartedCallback:s,punchInCallback:l,punchOutCallback:c}){if(y.instance)return y.instance;console.log("once created will not again");let i=(0,n.io)(a,{auth:{token:f("token")}});return i.on("punch_in",e=>{console.dir(" [socket] punch-in data:",e),l(e)}),i.on("punch_out",e=>{console.dir("[socket] punch-out data:",e),c(e)}),i.on("new_message",t=>{console.dir("[socket] new-message data:",t),e(t)}),i.on("connection",e=>{console.dir(" [socket] connected.."),t(e)}),i.on("success",e=>{(!e||(null==e?void 0:e.message))&&(e.message="connection successful"),console.dir("[socket] success message :",e),o(e)}),i.on("error",e=>{console.dir("[socket] error message :",e),r(e)}),i.on("attendance_started",e=>{console.dir("[socket] attendance started data : ",e),s(e)}),y.instance={socket:i,sendMessage:(e,t)=>{i.emit("new_message",{classroom_id:e,message:t})},startAttendance:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5;i.emit("start_attendance",{classroom_id:e,timeout:t})},joinClassRoom:e=>{i.emit("join_classroom",{classroom_ids:e})},punchIn:e=>{console.dir(" [socket] punch-in data:",e),i.emit("punch_in",e)},punchOut:e=>{console.dir("[socket] punch-out data:",e),i.emit("punch_out",e)}},y.instance}}let v=async()=>{try{let e=!1;if((e=f("user-login-detail"))&&0!==Object.getOwnPropertyNames(e||{}).length)return e;return!1}catch(e){return console.error((null==e?void 0:e.message)||"unknown error"),!1}};async function x(e,t,o){let{event_id:n,classroom_id:r,user_id:s}=e;try{let e=await m("".concat(a,'/api/attendances?user_id="674b3c5e7fffda283acb6bbf&limit=1"'),"GET",{}),o=null==e?void 0:e.totalRecords;if(console.log("pre :",e),!o)throw Error("No records found!");let n=await m("".concat(a,'/api/attendances?user_id="674b3c5e7fffda283acb6bbf&limit=').concat(o),"GET",{});t(n),console.log(n)}catch(e){o(e),console.log(e)}}async function w(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:()=>{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:()=>{};try{localStorage.removeItem("token"),localStorage.removeItem("user-login-detail"),e(),console.log("User logged out successfully.")}catch(e){console.error("Logout failed:",e),t(e)}}async function b(){try{let e=[];try{let t=await m("".concat(a,"/api/users?role=speaker"),"GET");Array.isArray(t)?e=t:Array.isArray(null==t?void 0:t.data)&&(e=t.data)}catch(e){console.warn("Filtered speakers fetch failed:",null==e?void 0:e.message)}if(!Array.isArray(e)||0===e.length){let t=await m("".concat(a,"/api/users"),"GET");e=(Array.isArray(t)?t:(null==t?void 0:t.data)||[]).filter(e=>(null==e?void 0:e.role)==="speaker")}return e||[]}catch(e){return console.error("Error fetching speakers:",(null==e?void 0:e.message)||e),[]}}x({},e=>console.log(e.message),e=>console.error(e.message)),w.handler=(e,t)=>()=>{w(e,t)}},4019:(e,t,o)=>{o.d(t,{A:()=>r});var n=o(5155),a=o(2115);let r=e=>{let{classroomId:t,onClose:o,socket:r,existingMessages:s}=e,[l,c]=(0,a.useState)([]),[i,d]=(0,a.useState)(""),u=(0,a.useRef)(null),[g,h]=(0,a.useState)(s||[]);(0,a.useEffect)(()=>{if(r)return r.socket.emit("join_room",t),r.socket.on("receive_message",e=>{c(t=>[...t,e]),setTimeout(()=>{var e;null==(e=u.current)||e.scrollTo({top:999999,behavior:"smooth"})},50)}),()=>{r.socket.emit("leave_room",t)}},[r,t]);let m=()=>{if(!i.trim())return;let e={room:t,message:i.trim(),at:Date.now()};r.socket.emit("send_message",e),d("")};return(0,n.jsx)("div",{className:"fixed inset-0 bg-black/50 z-50 flex items-center justify-center",children:(0,n.jsxs)("div",{className:"bg-white w-full max-w-lg rounded-2xl shadow-lg flex flex-col h-[70vh]",children:[(0,n.jsxs)("div",{className:"flex justify-between items-center p-4 border-b",children:[(0,n.jsx)("h3",{className:"text-lg font-semibold",children:"Classroom Chat"}),(0,n.jsx)("button",{className:"px-3 py-1 rounded-md border",onClick:o,children:"Close"})]}),(0,n.jsx)("div",{ref:u,className:"flex-1 overflow-y-auto p-4 space-y-3",children:0==[...l,...g].length?(0,n.jsx)("p",{className:"text-sm text-gray-500 text-center mt-10",children:"No messages yet"}):[...l,...g].map((e,t)=>(0,n.jsxs)("div",{className:"bg-gray-100 p-2 rounded-lg",children:[(0,n.jsx)("p",{className:"text-sm",children:e.message}),(0,n.jsx)("p",{className:"text-[10px] text-gray-500",children:new Date(e.at).toLocaleString()})]},t))}),(0,n.jsxs)("div",{className:"p-4 border-t flex gap-2",children:[(0,n.jsx)("input",{className:"flex-1 border rounded-md px-3 py-2",placeholder:"Write message...",value:i,onChange:e=>d(e.target.value),onKeyDown:e=>"Enter"===e.key&&m()}),(0,n.jsx)("button",{className:"bg-blue-600 text-white px-4 py-2 rounded-md",onClick:m,children:"Send"})]})]})})}},4239:(e,t,o)=>{o.d(t,{A$:()=>n.A$,AS:()=>n.AS,DY:()=>n.DY,In:()=>n.In,Pq:()=>n.Pq,VU:()=>n.VU,Yq:()=>n.Yq,eg:()=>n.eg,kQ:()=>n.kQ,lh:()=>n.lh,pn:()=>n.pn,s_:()=>n.s_,xF:()=>n.xF,zz:()=>n.zz});var n=o(2105)},8020:(e,t,o)=>{o.d(t,{A:()=>s});var n=o(5155),a=o(6766),r=o(8274);function s(){return(0,n.jsxs)("div",{className:"fixed inset-0 z-50 flex flex-col items-center justify-center bg-white",children:[(0,n.jsx)(r.P.div,{initial:{scale:.8,opacity:.5},animate:{scale:[.9,1.1,.9],opacity:[.5,1,.5]},transition:{duration:2,repeat:1/0,ease:"easeInOut"},className:"absolute w-64 h-64 rounded-full bg-gradient-to-tr from-blue-400 to-purple-500 blur-3xl opacity-30"}),(0,n.jsx)(r.P.div,{initial:{scale:.8,opacity:0},animate:{scale:1,opacity:1},transition:{duration:.8,ease:"easeOut"},children:(0,n.jsx)(a.default,{src:"/loader.png",alt:"Loading...",width:200,height:200,priority:!0,className:"drop-shadow-lg"})}),(0,n.jsx)(r.P.p,{initial:{opacity:0},animate:{opacity:[0,1,0]},transition:{duration:1.5,repeat:1/0},className:"mt-6 text-lg font-semibold text-gray-600",children:"Loading..."})]})}}}]);