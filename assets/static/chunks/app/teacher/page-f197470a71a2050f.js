(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[411],{3327:(e,t,a)=>{"use strict";a.d(t,{default:()=>A});var s=a(5155),l=a(2115),r=a(5799);a(5716);var n=a(4239);let o=e=>{try{if(!e)return null;let t=new Date(e);return isNaN(t.getTime())?null:t}catch(e){return null}},i=e=>e?"string"==typeof e?e:e._id||"":"",d=function(e,t){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0;try{var s;return null!=(s=t.split(".").reduce((e,t)=>e?e[t]:void 0,e))?s:a}catch(e){return a}},c=()=>{let[e,t]=(0,l.useState)([]),[a,r]=(0,l.useState)([]),[c,u]=(0,l.useState)(!0),[m,x]=(0,l.useState)(""),[h,p]=(0,l.useState)(""),[g,b]=(0,l.useState)(""),[f,v]=(0,l.useState)(""),[y,j]=(0,l.useState)(""),[N,w]=(0,l.useState)(""),[S,k]=(0,l.useState)(""),[C,A]=(0,l.useState)(""),[_,E]=(0,l.useState)(1);(0,l.useEffect)(()=>{D(),L()},[]),(0,l.useEffect)(()=>{L()},[h]);let D=async()=>{try{let e=await fetch("".concat(n.AS,"/api/events")),t=await e.json();if(!(null==t?void 0:t.events)||!Array.isArray(t.events))throw Error("Invalid events data format");r(t.events)}catch(e){console.error("Event fetch error:",e)}},L=async()=>{u(!0),x("");try{await (0,n.Yq)({event_id:h||void 0},e=>{let a=(Array.isArray(null==e?void 0:e.data)?e.data:[]).map(e=>({...e,_eventId:i(e.event_id),_userId:i(e.user_id)})).sort((e,t)=>{let a=o(e.punch_in_time),s=o(t.punch_in_time);return a&&s?s-a:a&&!s?-1:!a&&s?1:0});t(a)},e=>x((null==e?void 0:e.message)||"Error fetching attendance"))}catch(e){x((null==e?void 0:e.message)||"Fetch failed")}finally{u(!1)}},R=e=>{let t=i(e);if(!t)return"N/A";let s=a.find(e=>i(e._id)===t);return(null==s?void 0:s.title)||d(e,"title")||"N/A"},P=e=>{if(!Array.isArray(e)||0===e.length)return"no-locations";if(1===e.length)return"single";let t=e[0],a=e[e.length-1],s=((e,t,a,s)=>{let l=e=>e*Math.PI/180;if([e,t,a,s].some(e=>null==e||Number.isNaN(Number(e))))return null;let r=l(Number(e)),n=l(Number(a)),o=Math.sin(l(Number(a)-Number(e))/2)**2+Math.cos(r)*Math.cos(n)*Math.sin(l(Number(s)-Number(t))/2)**2;return 2*Math.atan2(Math.sqrt(o),Math.sqrt(1-o))*6371e3})(null==t?void 0:t.lat,null==t?void 0:t.long,null==a?void 0:a.lat,null==a?void 0:a.long);return null===s?"no-locations":s<=15?"in":"out"},F=(0,l.useMemo)(()=>{let t=new Set;return e.forEach(e=>e.status&&t.add(e.status)),Array.from(t)},[e]),O=(0,l.useMemo)(()=>{let t=e.filter(e=>{var t;let a=(e.name||d(e,"user_id.name","")).toLowerCase(),s=(e.branch||d(e,"user_id.branch","")||"").toString().trim().toLowerCase(),l=(e.year||d(e,"user_id.year","")||"").toString().trim().toLowerCase(),r=(e.enrollment_id||d(e,"user_id.enrollment_id","")).toString().toLowerCase(),n=!h||i(e.event_id)===h,o=!g||(null==(t=e.status)?void 0:t.toLowerCase())===g.toLowerCase(),c=P(e.locations),u=!f||c===f,m=!y||a.includes(y.toLowerCase()),x=!N||s.includes(N.trim().toLowerCase()),p=!S||r.includes(S.trim().toLowerCase()),b=!C||l.includes(C.trim().toLowerCase());return n&&o&&u&&m&&x&&p&&b});return E(1),t},[e,h,g,f,y,N,S,C]),U=50*_,M=O.slice(U-50,U),T=Math.ceil(O.length/50);return c?(0,s.jsx)("div",{className:"py-10 text-center",children:"Loading..."}):m?(0,s.jsx)("div",{className:"py-10 text-center text-red-600",children:m}):(0,s.jsxs)("div",{className:"p-6 bg-gray-50 min-h-screen",children:[(0,s.jsxs)("div",{className:"flex flex-col md:flex-row md:justify-between md:items-center mb-6 gap-4",children:[(0,s.jsx)("h2",{className:"text-2xl font-semibold",children:"Attendance Management"}),(0,s.jsx)("button",{onClick:()=>(e=>{if(!e.length)return alert("No data to export");let t=[["Event Name","User Name","Nickname","Enrollment ID","Branch","Year","Status","Punch In","Punch Out","Punch In Location","Punch Out Location","Distance Bucket"],...e.map(e=>{let t=e.branch||d(e,"user_id.branch","N/A"),a=e.year||d(e,"user_id.year","N/A"),s=R(e.event_id),l=e.name||d(e,"user_id.name","N/A"),r=e.nickname||d(e,"user_id.nickname","N/A"),n=e.enrollment_id||d(e,"user_id.enrollment_id","N/A"),i=o(e.punch_in_time),c=o(e.punch_out_time),u=Array.isArray(e.locations)?e.locations:[],m=u[0],x=u[u.length-1],h=P(u);return[s,l,r,n,t,a,e.status,i?i.toLocaleString():"N/A",c?c.toLocaleString():"N/A",m?"".concat(m.lat,", ").concat(m.long):"N/A",x?"".concat(x.lat,", ").concat(x.long):"N/A",h.toUpperCase()]})].map(e=>e.map(e=>'"'.concat(String(e).replace(/"/g,'""'),'"')).join(",")).join("\n"),a=URL.createObjectURL(new Blob([t],{type:"text/csv"})),s=document.createElement("a");s.href=a,s.download="attendance.csv",s.click(),URL.revokeObjectURL(a)})(O),className:"bg-green-600 text-white px-4 py-2 rounded-lg shadow hover:bg-green-700",children:"\uD83D\uDCE5 Download CSV (All)"})]}),(0,s.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-6 gap-4 bg-white p-4 rounded-md shadow mb-8",children:[(0,s.jsxs)("select",{value:h,onChange:e=>p(e.target.value),className:"border p-2 rounded",children:[(0,s.jsx)("option",{value:"",children:"All Events"}),a.map(e=>(0,s.jsx)("option",{value:i(e._id),children:e.title},i(e._id)))]}),(0,s.jsxs)("select",{value:g,onChange:e=>b(e.target.value),className:"border p-2 rounded",children:[(0,s.jsx)("option",{value:"",children:"All Status"}),F.map(e=>(0,s.jsx)("option",{children:e},e))]}),(0,s.jsxs)("select",{value:f,onChange:e=>v(e.target.value),className:"border p-2 rounded",children:[(0,s.jsx)("option",{value:"",children:"Distance (All)"}),(0,s.jsx)("option",{value:"in",children:"IN (≤15m)"}),(0,s.jsx)("option",{value:"out",children:"OUT (>15m)"}),(0,s.jsx)("option",{value:"single",children:"Single"}),(0,s.jsx)("option",{value:"no-locations",children:"No Locations"})]}),(0,s.jsx)("input",{type:"text",placeholder:"Search Name",value:y,onChange:e=>j(e.target.value),className:"border p-2 rounded"}),(0,s.jsx)("input",{type:"text",placeholder:"Search Branch",value:N,onChange:e=>w(e.target.value),className:"border p-2 rounded"}),(0,s.jsx)("input",{type:"text",placeholder:"Search Year",value:C,onChange:e=>A(e.target.value),className:"border p-2 rounded"}),(0,s.jsx)("input",{type:"text",placeholder:"Enrollment",value:S,onChange:e=>k(e.target.value),className:"border p-2 rounded"})]}),(0,s.jsx)("div",{className:"overflow-x-auto bg-white shadow rounded-lg",children:(0,s.jsxs)("table",{className:"min-w-full table-auto",children:[(0,s.jsx)("thead",{children:(0,s.jsxs)("tr",{className:"bg-gray-200",children:[(0,s.jsx)("th",{className:"px-4 py-2 text-left",children:"Event"}),(0,s.jsx)("th",{className:"px-4 py-2 text-left",children:"User"}),(0,s.jsx)("th",{className:"px-4 py-2 text-left",children:"Nickname"}),(0,s.jsx)("th",{className:"px-4 py-2 text-left",children:"Enrollment"}),(0,s.jsx)("th",{className:"px-4 py-2 text-left",children:"Branch"}),(0,s.jsx)("th",{className:"px-4 py-2 text-left",children:"Year"}),(0,s.jsx)("th",{className:"px-4 py-2 text-left",children:"Status"}),(0,s.jsx)("th",{className:"px-4 py-2 text-left",children:"Punch In"}),(0,s.jsx)("th",{className:"px-4 py-2 text-left",children:"Punch Out"}),(0,s.jsx)("th",{className:"px-4 py-2 text-left",children:"In Location"}),(0,s.jsx)("th",{className:"px-4 py-2 text-left",children:"Out Location"}),(0,s.jsx)("th",{className:"px-4 py-2 text-left",children:"15m"})]})}),(0,s.jsx)("tbody",{children:M.map((e,t)=>{let a=R(e.event_id),l=e.name||d(e,"user_id.name","N/A"),r=e.nickname||d(e,"user_id.nickname","N/A"),n=e.enrollment_id||d(e,"user_id.enrollment_id","N/A"),i=e.branch||d(e,"user_id.branch","N/A"),c=e.year||d(e,"user_id.year","N/A"),u=o(e.punch_in_time),m=o(e.punch_out_time),x=Array.isArray(e.locations)?e.locations:[],h=x[0],p=x[x.length-1],g=P(x);return(0,s.jsxs)("tr",{className:"border-b",children:[(0,s.jsx)("td",{className:"px-4 py-2",children:a}),(0,s.jsx)("td",{className:"px-4 py-2",children:l}),(0,s.jsx)("td",{className:"px-4 py-2",children:r}),(0,s.jsx)("td",{className:"px-4 py-2",children:n}),(0,s.jsx)("td",{className:"px-4 py-2",children:i}),(0,s.jsx)("td",{className:"px-4 py-2",children:c}),(0,s.jsx)("td",{className:"px-4 py-2",children:e.status}),(0,s.jsx)("td",{className:"px-4 py-2",children:u?u.toLocaleString():"N/A"}),(0,s.jsx)("td",{className:"px-4 py-2",children:m?m.toLocaleString():"N/A"}),(0,s.jsx)("td",{className:"px-4 py-2",children:h?"".concat(h.lat,", ").concat(h.long):"N/A"}),(0,s.jsx)("td",{className:"px-4 py-2",children:p?"".concat(p.lat,", ").concat(p.long):"N/A"}),(0,s.jsx)("td",{className:"px-4 py-2",children:"in"===g?"✔️":"out"===g?"❌":"single"===g?"•":"N/A"})]},e._id||t)})})]})}),(0,s.jsxs)("div",{className:"mt-6 flex justify-center items-center gap-3",children:[(0,s.jsx)("button",{onClick:()=>_>1&&E(e=>e-1),disabled:1===_,className:"px-4 py-2 bg-gray-200 rounded disabled:opacity-50",children:"◀ Prev"}),(0,s.jsxs)("span",{className:"px-4 py-2 font-semibold",children:["Page ",_," / ",T]}),(0,s.jsx)("button",{onClick:()=>_<T&&E(e=>e+1),disabled:_===T,className:"px-4 py-2 bg-gray-200 rounded disabled:opacity-50",children:"Next ▶"})]}),0===O.length&&(0,s.jsx)("div",{className:"mt-6 text-center text-gray-600",children:"No records found."})]})};var u=a(7634),m=a(2838),x=a(5526);let h=[{name:"Nagar Auditorium",lat:"22.381599362662463",long:"73.14314073548469"},{name:"SOT Auditorium",lat:"22.385636040754616",long:"73.14493074913331"},{name:"Anviksha Building",lat:"22.3862105355751",long:"73.14561660211221"},{name:"SOS Building",lat:"22.382901016778522",long:"73.14696416837283"},{name:"Aangava",lat:"22.385277259337578",long:"73.14446294649058"},{name:"Basket Ball Court ( Aangava )",lat:"22.385232418863385",long:"73.14407034812744"}];function p(e){let{items:t,display:a,value:r,onChange:n,placeholder:o="Search...",multiple:i=!1}=e,[d,c]=(0,l.useState)(""),[u,m]=(0,l.useState)(!1),x=(0,l.useRef)(null),h=e=>a(e)||(null==e?void 0:e.name)||"".concat((null==e?void 0:e.first_name)||""," ").concat((null==e?void 0:e.last_name)||"").trim(),p=(0,l.useMemo)(()=>{let e=d.toLowerCase().trim();return t.filter(t=>!(i&&Array.isArray(r)&&r.includes(t._id))&&(!e||(h(t)||"").toLowerCase().includes(e)))},[t,d,a,r,i]),g=(0,l.useMemo)(()=>{if(i)return"";let e=t.find(e=>r&&(null==e?void 0:e._id)===r);return e?h(e):""},[t,r,a,i]);return(0,s.jsxs)("div",{className:"relative",children:[i&&Array.isArray(r)&&r.length>0&&(0,s.jsx)("div",{className:"flex flex-wrap gap-2 mb-2",children:r.map(e=>{let a=t.find(t=>t._id===e);return a?(0,s.jsxs)("span",{className:"inline-flex items-center px-2 py-1 rounded bg-blue-100 text-blue-800 text-sm",children:[h(a),(0,s.jsx)("button",{type:"button",onClick:t=>{t.preventDefault(),t.stopPropagation(),i&&Array.isArray(r)&&(null==n||n(r.filter(t=>t!==e)))},className:"ml-1 text-blue-600 hover:text-blue-800 focus:outline-none font-bold",children:"\xd7"})]},e):null})}),(0,s.jsx)("input",{ref:x,type:"text",placeholder:o,value:i||u?d:g,onChange:e=>c(e.target.value),onFocus:()=>m(!0),onBlur:()=>{setTimeout(()=>m(!1),100)},className:"w-full border border-gray-300 rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-400"}),u&&(0,s.jsxs)("div",{className:"absolute z-20 mt-1 w-full bg-white border border-gray-200 rounded shadow max-h-60 overflow-auto",children:[0===p.length&&(0,s.jsx)("div",{className:"px-3 py-2 text-sm text-gray-500",children:"No results"}),p.map(e=>{let t=h(e);return(0,s.jsx)("button",{type:"button",className:"w-full text-left px-3 py-2 hover:bg-gray-50",onClick:()=>(e=>{if(i){var t;let a=Array.isArray(r)?r:[];a.includes(e)||null==n||n([...a,e]),c(""),null==(t=x.current)||t.focus()}else null==n||n(e),m(!1),c("")})(e._id),children:t},e._id)})]})]})}function g(){let[e,t]=(0,l.useState)(!1),[a,o]=(0,l.useState)(""),[i,d]=(0,l.useState)([]),[c,u]=(0,l.useState)([]),[m,g]=(0,l.useState)(""),[b,f]=(0,l.useState)(""),[v,y]=(0,l.useState)("");(0,l.useEffect)(()=>{(async()=>{d(await (0,n.Pq)()||[])})()},[]);let j=async e=>{if(e.preventDefault(),0===c.length)return void r.oR.error("Please select at least one speaker");t(!0);try{await (0,n.lh)(e,()=>r.oR.success("Event created successfully!"),e=>r.oR.error((null==e?void 0:e.message)||"Failed to create event")),e.target.reset(),o(""),u([]),g(""),f(""),y("")}finally{t(!1)}};return(0,s.jsxs)("div",{className:"max-w-4xl mx-auto p-6 bg-white shadow-md rounded-lg mt-6",children:[(0,s.jsx)("h2",{className:"text-2xl font-bold mb-6 text-gray-800",children:"Create Event"}),(0,s.jsxs)("div",{className:"mb-6",children:[(0,s.jsx)(x.default,{onUploadSuccess:o}),a&&(0,s.jsxs)("p",{className:"text-sm text-green-700 mt-2 break-all",children:["Uploaded: ",a]})]}),(0,s.jsxs)("form",{id:"createEvent",onSubmit:j,className:"space-y-6",children:[(0,s.jsx)("input",{type:"hidden",name:"speaker_ids",value:c.join(",")||""}),(0,s.jsx)("input",{type:"hidden",name:"banner_url",value:a||""}),(0,s.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,s.jsx)("input",{type:"checkbox",className:"h-4 w-4 text-blue-600 border-gray-300 rounded",name:"mandatory",defaultChecked:!0}),(0,s.jsx)("label",{className:"text-gray-700",children:"Mandatory"})]}),(0,s.jsxs)("div",{children:[(0,s.jsxs)("label",{htmlFor:"title",className:"block text-gray-700 font-medium mb-1",children:["Title ",(0,s.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,s.jsx)("input",{id:"title",name:"title",required:!0,className:"w-full border border-gray-300 rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-400"})]}),(0,s.jsxs)("fieldset",{className:"border border-gray-200 p-4 rounded",children:[(0,s.jsx)("legend",{className:"font-semibold text-gray-700",children:"Description"}),(0,s.jsxs)("div",{className:"mt-4",children:[(0,s.jsx)("label",{htmlFor:"detail",className:"block text-gray-700 mb-1",children:"Detail"}),(0,s.jsx)("textarea",{id:"detail",name:"detail",className:"w-full border border-gray-300 rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-400",placeholder:"Optional extra details about the event"})]}),(0,s.jsxs)("div",{className:"mt-4",children:[(0,s.jsxs)("label",{htmlFor:"objectives",className:"block text-gray-700 mb-1",children:["Objectives ",(0,s.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,s.jsx)("textarea",{id:"objectives",name:"objectives",required:!0,className:"w-full border border-gray-300 rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-400",placeholder:"One per line"})]}),(0,s.jsxs)("div",{className:"mt-4",children:[(0,s.jsxs)("label",{htmlFor:"learning_outcomes",className:"block text-gray-700 mb-1",children:["Learning Outcomes ",(0,s.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,s.jsx)("textarea",{id:"learning_outcomes",name:"learning_outcomes",required:!0,className:"w-full border border-gray-300 rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-400",placeholder:"One per line"})]})]}),(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{htmlFor:"start_time",className:"block text-gray-700 mb-1",children:"Start Time *"}),(0,s.jsx)("input",{type:"datetime-local",id:"start_time",name:"start_time",required:!0,className:"w-full border border-gray-300 rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-400"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{htmlFor:"end_time",className:"block text-gray-700 mb-1",children:"End Time *"}),(0,s.jsx)("input",{type:"datetime-local",id:"end_time",name:"end_time",required:!0,className:"w-full border border-gray-300 rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-400"})]})]}),(0,s.jsxs)("fieldset",{className:"border border-gray-200 p-4 rounded bg-gray-50",children:[(0,s.jsx)("legend",{className:"font-semibold text-gray-700",children:"Location"}),(0,s.jsxs)("div",{className:"mt-2",children:[(0,s.jsxs)("label",{htmlFor:"address",className:"block text-gray-700 mb-1",children:["Address / Venue ",(0,s.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,s.jsxs)("select",{id:"address",name:"address",required:!0,value:m,onChange:e=>{let t=e.target.value;g(t);let a=h.find(e=>e.name===t);a?(f(a.lat),y(a.long)):(f(""),y(""))},className:"w-full border border-gray-300 rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-400 bg-white",children:[(0,s.jsx)("option",{value:"",children:"-- Select a Venue --"}),h.map(e=>(0,s.jsx)("option",{value:e.name,children:e.name},e.name))]})]}),(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mt-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{htmlFor:"lat",className:"block text-gray-700 mb-1",children:"Latitude"}),(0,s.jsx)("input",{type:"number",id:"lat",name:"lat",step:"any",value:b,onChange:e=>f(e.target.value),placeholder:"Auto-filled",className:"w-full border border-gray-300 rounded px-3 py-2 bg-gray-100 focus:outline-none focus:ring-2 focus:ring-blue-400"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{htmlFor:"long",className:"block text-gray-700 mb-1",children:"Longitude"}),(0,s.jsx)("input",{type:"number",id:"long",name:"long",step:"any",value:v,onChange:e=>y(e.target.value),placeholder:"Auto-filled",className:"w-full border border-gray-300 rounded px-3 py-2 bg-gray-100 focus:outline-none focus:ring-2 focus:ring-blue-400"})]})]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-gray-700 mb-1",children:"Speaker"}),(0,s.jsx)(p,{items:i,value:c,onChange:u,multiple:!0,placeholder:"Search speaker by name",display:e=>(null==e?void 0:e.name)||"".concat((null==e?void 0:e.first_name)||""," ").concat((null==e?void 0:e.last_name)||"").trim()}),c.length>0&&(0,s.jsxs)("p",{className:"text-sm text-gray-600 mt-2",children:["Selected: ",c.length," speaker(s)"]})]}),(0,s.jsx)("button",{type:"submit",disabled:e,className:"w-full bg-green-700 text-white font-semibold py-2 px-4 rounded transition duration-200 disabled:opacity-50",children:e?"Submitting...":"Create Event"})]}),(0,s.jsx)(r.ToastContainer,{})]})}var b=a(9911);let f=(0,a(5028).default)(()=>Promise.resolve().then(a.bind(a,5526)),{loadableGenerated:{webpack:()=>[5526]},ssr:!1});function v(){let[e,t]=(0,l.useState)(""),[a,o]=(0,l.useState)(!1),[i,d]=(0,l.useState)(!1),[c,u]=(0,l.useState)(0),[m,x]=(0,l.useState)(!1),h={style:{background:"green",color:"white"}},p={style:{background:"red",color:"white"}},g={style:{background:"orange",color:"black"}};(0,l.useEffect)(()=>{if(c>0){let e=setTimeout(()=>u(e=>e-1),1e3);return()=>clearTimeout(e)}},[c]);let v=async e=>{if(!e.trim())return void r.oR.warning("Enter email first!",g);x(!0);try{let t=await (0,n.A$)(e,"verification");(null==t?void 0:t.success)?(r.oR.success("OTP sent!",h),u(15)):r.oR.error((null==t?void 0:t.message)||"Failed to send OTP!",p)}catch(e){r.oR.error("Error sending OTP!",p)}finally{x(!1)}},y=async a=>{a.preventDefault(),d(!0);let s=new FormData(a.target);return(console.log(Object.entries(s.entries())),e)?(s.get("password")||"").length<8?(r.oR.warning("Password must be at least 8 characters!",g),d(!1)):s.get("otp")?void(await (0,n.Wj)({preventDefault:()=>{},target:a.target,submitter:a.nativeEvent.submitter},e=>{r.oR.success((null==e?void 0:e.message)||"Speaker registered!",h),a.target.reset(),t(""),u(0)},e=>r.oR.error((null==e?void 0:e.message)||"Failed to register speaker!",p)),d(!1)):(r.oR.warning("OTP required!",g),d(!1)):(r.oR.warning("Upload a speaker image!",g),d(!1))};return(0,s.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-gray-50 px-4 py-10",children:(0,s.jsxs)("div",{className:"w-full max-w-2xl bg-white shadow-lg rounded-2xl p-8",children:[(0,s.jsx)("h2",{className:"text-2xl font-semibold text-center text-gray-800",children:"Register a Speaker"}),(0,s.jsx)(f,{onUploadSuccess:t}),(0,s.jsxs)("form",{onSubmit:y,className:"space-y-5 mt-6",children:[(0,s.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[(0,s.jsx)("input",{name:"name",placeholder:"Name",className:"p-3 border rounded-lg"}),(0,s.jsx)("input",{name:"nickname",placeholder:"Nickname",className:"p-3 border rounded-lg"})]}),(0,s.jsxs)("div",{className:"flex flex-col sm:flex-row gap-3",children:[(0,s.jsx)("input",{name:"email",type:"email",placeholder:"Email",className:"flex-1 p-3 border rounded-lg"}),(0,s.jsx)("button",{type:"button",disabled:c>0,onClick:()=>v(document.querySelector("input[name='email']").value),className:"px-5 py-2 rounded-lg text-white ".concat(c>0?"bg-gray-400":"bg-green-600 hover:bg-green-700"),children:m?"Sending...":c>0?"Wait ".concat(c,"s"):"Get OTP"})]}),(0,s.jsx)("input",{name:"otp",placeholder:"OTP",className:"w-full p-3 border rounded-lg"}),(0,s.jsx)("input",{name:"role",type:"text",value:"Speaker",hidden:!0}),(0,s.jsx)("input",{name:"imageUrl",type:"text",value:e,hidden:!0}),(0,s.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[(0,s.jsxs)("select",{name:"gender",className:"p-3 border rounded-lg",children:[(0,s.jsx)("option",{value:"Male",children:"Male"}),(0,s.jsx)("option",{value:"Female",children:"Female"})]}),(0,s.jsxs)("div",{className:"relative",children:[(0,s.jsx)("input",{type:a?"text":"password",name:"password",placeholder:"Password",className:"p-3 border rounded-lg w-full pr-10"}),(0,s.jsx)("button",{type:"button",onClick:()=>o(e=>!e),className:"absolute top-3 right-3 text-gray-600",children:a?(0,s.jsx)(b.Ny1,{}):(0,s.jsx)(b.mx3,{})})]})]}),(0,s.jsx)("textarea",{name:"about",placeholder:"About Speaker",className:"w-full p-3 border rounded-lg"}),(0,s.jsx)("input",{name:"organization",placeholder:"Organization",className:"w-full p-3 border rounded-lg"}),(0,s.jsx)("textarea",{name:"links",placeholder:"Speaker Links (comma separated)\\nExample: https://linkedin.com/in/xyz, https://google.com",className:"w-full p-3 border rounded-lg",rows:3}),(0,s.jsx)("button",{type:"submit",disabled:i,className:"w-full py-3 rounded-lg text-white ".concat(i?"bg-green-400":"bg-green-600 hover:bg-green-700"),children:i?"Submitting...":"Register"})]}),(0,s.jsx)(r.ToastContainer,{autoClose:2e3,hideProgressBar:!0,theme:"colored"})]})})}var y=a(2502),j=a(4065),N=a(2834);y.t1.register(y.PP,y.kc,y.E8,y.hE,y.m_,y.s$,y.Bs,N.A);let w=e=>(e&&"object"==typeof e?e._id:e)||"",S=(e,t,a)=>{try{var s;return null!=(s=t.split(".").reduce((e,t)=>e?e[t]:void 0,e))?s:a}catch(e){return a}},k=e=>{let{options:t,value:a,onChange:r,placeholder:n="Select Event"}=e,[o,i]=(0,l.useState)(!1),[d,c]=(0,l.useState)(""),u=(0,l.useRef)(null);(0,l.useEffect)(()=>{let e=e=>{u.current&&!u.current.contains(e.target)&&i(!1)};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[]);let m=t.filter(e=>e.title.toLowerCase().includes(d.toLowerCase())),x=t.find(e=>w(e)===a),h=x?x.title:"All Events";return(0,s.jsxs)("div",{className:"relative",ref:u,children:[(0,s.jsxs)("div",{className:"border p-2 rounded bg-white cursor-pointer flex justify-between items-center h-[42px]",onClick:()=>{i(!o),c("")},children:[(0,s.jsx)("span",{className:"truncate ".concat(a?"text-gray-900":"text-gray-600"),children:h}),(0,s.jsx)("span",{className:"text-gray-400 text-xs ml-2",children:"▼"})]}),o&&(0,s.jsxs)("div",{className:"absolute top-full left-0 right-0 mt-1 bg-white border rounded shadow-lg z-50 max-h-60 overflow-hidden flex flex-col",children:[(0,s.jsx)("input",{autoFocus:!0,type:"text",placeholder:"Search event...",className:"p-2 border-b w-full outline-none text-sm bg-gray-50",value:d,onChange:e=>c(e.target.value)}),(0,s.jsxs)("div",{className:"overflow-y-auto",children:[(0,s.jsx)("div",{className:"p-2 hover:bg-blue-50 cursor-pointer text-gray-600 border-b border-gray-100",onClick:()=>{r(""),i(!1)},children:"All Events"}),m.length>0?m.map(e=>(0,s.jsx)("div",{className:"p-2 hover:bg-blue-50 cursor-pointer truncate ".concat(w(e)===a?"bg-blue-100 text-blue-800":"text-gray-800"),onClick:()=>{r(w(e)),i(!1)},children:e.title},w(e))):(0,s.jsx)("div",{className:"p-2 text-gray-400 text-sm text-center",children:"No events found"})]})]})]})},C=()=>{let[e,t]=(0,l.useState)([]),[a,r]=(0,l.useState)([]),[o,i]=(0,l.useState)(!0),[d,c]=(0,l.useState)(""),[u,m]=(0,l.useState)(""),[x,h]=(0,l.useState)(""),[p,g]=(0,l.useState)(null);(0,l.useEffect)(()=>{(async()=>{try{let e=await fetch("".concat(n.AS,"/api/events")),a=await e.json();r(a.events||[]),await (0,n.Yq)({},e=>{let a=(Array.isArray(null==e?void 0:e.data)?e.data:[]).map(e=>{var t,a,s,l,r,n,o,i;return{...e,branch:(e.branch||S(e,"user_id.branch","Unknown")).toUpperCase(),year:(e.year||S(e,"user_id.year","Unknown")).toString(),eventId:w(e.event_id),dist:((e,t,a,s)=>{if(!e||!t||!a||!s)return null;let l=e=>e*Math.PI/180,r=Math.sin(l(a-e)/2)**2+Math.cos(l(e))*Math.cos(l(a))*Math.sin(l(s-t)/2)**2;return 12742e3*Math.atan2(Math.sqrt(r),Math.sqrt(1-r))})(null==(a=e.locations)||null==(t=a[0])?void 0:t.lat,null==(l=e.locations)||null==(s=l[0])?void 0:s.long,null==(n=e.locations)||null==(r=n.at(-1))?void 0:r.lat,null==(i=e.locations)||null==(o=i.at(-1))?void 0:o.long)}});t(a),i(!1)})}catch(e){console.error(e),i(!1)}})()},[]);let b=(0,l.useMemo)(()=>e.filter(e=>{let t=!d||e.eventId===d,a=!u||e.branch.includes(u.toUpperCase()),s=!x||e.year.includes(x);return t&&a&&s}),[e,d,u,x]),f=(0,l.useMemo)(()=>{let e=e=>{let t={};return b.forEach(a=>{let s=e(a);t[s]=(t[s]||0)+1}),{labels:Object.keys(t),values:Object.values(t)}},t=e(e=>e.status||"Unknown"),a=e(e=>e.branch),s=e(e=>e.year),l={"In Range (≤15m)":0,"Out of Range (>15m)":0,Unknown:0};return b.forEach(e=>{null===e.dist?l.Unknown++:e.dist<=15?l["In Range (≤15m)"]++:l["Out of Range (>15m)"]++}),{status:{labels:t.labels,datasets:[{label:"Students",data:t.values,backgroundColor:["#10B981","#EF4444","#F59E0B","#3B82F6"]}]},branch:{labels:a.labels,datasets:[{label:"Count",data:a.values,backgroundColor:"#6366F1"}]},year:{labels:s.labels,datasets:[{label:"Count",data:s.values,backgroundColor:"#8B5CF6"}]},distance:{labels:Object.keys(l),datasets:[{data:Object.values(l),backgroundColor:["#10B981","#EF4444","#9CA3AF"]}]}}},[b]),v=function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return{responsive:!0,maintainAspectRatio:!1,layout:{padding:{top:20*!!t}},plugins:{legend:{position:"top",labels:{font:{size:12}}},title:{display:!!e,text:e,font:{size:16}},datalabels:{color:t?"#555555":"#ffffff",font:{weight:"bold",size:11},anchor:t?"end":"center",align:t?"top":"center",offset:4*!!t,formatter:(e,t)=>{let a=0;if(t.chart.data.datasets[0].data.map(e=>{a+=e}),0===a)return"";let s=(100*e/a).toFixed(1)+"%";return 100*e/a>2?s:""}}},scales:t?{x:{display:!0,grid:{display:!1},ticks:{autoSkip:!1,maxRotation:90,minRotation:45}},y:{display:!0,beginAtZero:!0,grid:{display:!0,color:"#f0f0f0"}}}:{x:{display:!1},y:{display:!1}}}};return o?(0,s.jsx)("div",{className:"p-10 text-center text-lg animate-pulse",children:"Loading Analytics..."}):(0,s.jsxs)("div",{className:"p-6 bg-gray-50 min-h-screen",children:[(0,s.jsxs)("div",{className:"bg-white p-4 rounded-lg shadow mb-6",children:[(0,s.jsx)("h2",{className:"text-2xl font-bold mb-4 text-gray-800",children:"\uD83D\uDCCA Attendance Analytics"}),(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,s.jsx)(k,{options:a,value:d,onChange:e=>c(e)}),(0,s.jsx)("input",{placeholder:"Filter by Branch (e.g. CSE)",className:"border p-2 rounded h-[42px]",value:u,onChange:e=>m(e.target.value)}),(0,s.jsx)("input",{placeholder:"Filter by Year (e.g. 2025)",className:"border p-2 rounded h-[42px]",value:x,onChange:e=>h(e.target.value)})]}),(0,s.jsxs)("p",{className:"mt-2 text-sm text-gray-500 text-right",children:["Showing ",b.length," records"]})]}),(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,s.jsxs)("div",{className:"bg-white p-5 rounded-xl shadow-md cursor-pointer hover:shadow-xl transition-shadow border border-transparent hover:border-blue-500 group",onClick:()=>g("status"),children:[(0,s.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,s.jsx)("h3",{className:"font-semibold text-gray-700",children:"Attendance Status"}),(0,s.jsx)("span",{className:"text-xs text-blue-500 opacity-0 group-hover:opacity-100",children:"Click to Enlarge \uD83D\uDD0D"})]}),(0,s.jsx)("div",{className:"h-64 flex justify-center",children:(0,s.jsx)(j.Fq,{data:f.status,options:v(null,!1)})})]}),(0,s.jsxs)("div",{className:"bg-white p-5 rounded-xl shadow-md cursor-pointer hover:shadow-xl transition-shadow border border-transparent hover:border-blue-500 group",onClick:()=>g("branch"),children:[(0,s.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,s.jsx)("h3",{className:"font-semibold text-gray-700",children:"Branch Distribution"}),(0,s.jsx)("span",{className:"text-xs text-blue-500 opacity-0 group-hover:opacity-100",children:"Click to Enlarge \uD83D\uDD0D"})]}),(0,s.jsx)("div",{className:"h-64",children:(0,s.jsx)(j.yP,{data:f.branch,options:v(null,!0)})})]}),(0,s.jsxs)("div",{className:"bg-white p-5 rounded-xl shadow-md cursor-pointer hover:shadow-xl transition-shadow border border-transparent hover:border-blue-500 group",onClick:()=>g("distance"),children:[(0,s.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,s.jsx)("h3",{className:"font-semibold text-gray-700",children:"Location Accuracy"}),(0,s.jsx)("span",{className:"text-xs text-blue-500 opacity-0 group-hover:opacity-100",children:"Click to Enlarge \uD83D\uDD0D"})]}),(0,s.jsx)("div",{className:"h-64 flex justify-center",children:(0,s.jsx)(j.nu,{data:f.distance,options:v(null,!1)})})]}),(0,s.jsxs)("div",{className:"bg-white p-5 rounded-xl shadow-md cursor-pointer hover:shadow-xl transition-shadow border border-transparent hover:border-blue-500 group",onClick:()=>g("year"),children:[(0,s.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,s.jsx)("h3",{className:"font-semibold text-gray-700",children:"Year Distribution"}),(0,s.jsx)("span",{className:"text-xs text-blue-500 opacity-0 group-hover:opacity-100",children:"Click to Enlarge \uD83D\uDD0D"})]}),(0,s.jsx)("div",{className:"h-64",children:(0,s.jsx)(j.yP,{data:f.year,options:v(null,!0)})})]})]}),(()=>{let e,t;if(!p)return null;let a="branch"===p||"year"===p,l=v(p.toUpperCase()+" ANALYSIS",a);switch(l.plugins.datalabels.font.size=13,p){case"status":e=j.Fq,t=f.status;break;case"branch":e=j.yP,t=f.branch;break;case"year":e=j.yP,t=f.year;break;case"distance":e=j.nu,t=f.distance;break;default:return null}return(0,s.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-70 backdrop-blur-sm p-4",onClick:()=>g(null),children:(0,s.jsxs)("div",{className:"bg-white p-8 rounded-xl shadow-2xl w-full max-w-5xl h-[85vh] relative flex flex-col",onClick:e=>e.stopPropagation(),children:[(0,s.jsx)("button",{onClick:()=>g(null),className:"absolute top-4 right-4 text-gray-500 hover:text-red-500 text-2xl font-bold",children:"\xd7"}),(0,s.jsx)("div",{className:"flex-grow pt-4",children:(0,s.jsx)(e,{data:t,options:l})}),(0,s.jsxs)("div",{className:"mt-4 text-center text-gray-500",children:["Total Records: ",b.length]})]})})})()]})},A=()=>{let[e,t]=(0,l.useState)("attendance"),[a,o]=(0,l.useState)(!1);return(0,l.useEffect)(()=>{let e=sessionStorage.getItem("teacherActiveTab");e&&(t(e),"classroom"===e&&(o(!0),setTimeout(()=>{o(!1)},2e3)))},[]),(0,s.jsxs)("div",{className:"p-4 sm:p-6 md:p-8 font-sans bg-gray-50 min-h-screen",children:[(0,s.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,s.jsx)("h1",{className:"text-2xl md:text-3xl font-semibold text-gray-800 text-center md:text-left",children:"\uD83D\uDC69‍\uD83C\uDFEB Teacher Management Dashboard"}),(0,s.jsx)("button",{onClick:n.eg.handler(()=>{sessionStorage.clear(),window.location.href="/LoginSignUp"},e=>console.error(e)),className:"bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded-lg transition-all duration-300",children:"Logout"})]}),(0,s.jsx)("div",{className:"flex flex-wrap justify-center md:justify-start border-b border-gray-300 mb-6",children:[{id:"attendance",label:"Attendance"},{id:"classroom",label:"Classroom Live"},{id:"events",label:"All Events"},{id:"create-event",label:"Create Event"},{id:"create-speaker",label:"Register Speaker"},{id:"charts",label:"Charts"}].map(a=>(0,s.jsx)("button",{onClick:()=>(a=>{a!==e&&("classroom"===a?(sessionStorage.setItem("teacherActiveTab","classroom"),window.location.reload()):(sessionStorage.setItem("teacherActiveTab",a),t(a),o(!1)))})(a.id),className:"flex-1 md:flex-none px-4 py-2 text-sm sm:text-base text-center transition-all duration-300 \n              border-b-4 ".concat(e===a.id?"border-blue-500 font-semibold text-blue-600":"border-transparent text-gray-600 hover:text-blue-500"),children:a.label},a.id))}),(0,s.jsx)("div",{className:"bg-white rounded-xl shadow-md p-4 sm:p-6 overflow-auto min-h-[400px]",children:(()=>{if(a)return(0,s.jsxs)("div",{className:"flex flex-col justify-center items-center h-[60vh]",children:[(0,s.jsx)("div",{className:"animate-spin rounded-full h-16 w-16 border-t-4 border-b-4 border-blue-600 mb-6"}),(0,s.jsx)("h2",{className:"text-xl font-semibold text-gray-700 animate-pulse",children:"Loading Live Classroom..."})]});switch(e){case"attendance":return(0,s.jsx)(c,{});case"classroom":return(0,s.jsx)(u.A,{});case"events":return(0,s.jsx)(m.default,{});case"create-event":return(0,s.jsx)(g,{});case"create-speaker":return(0,s.jsx)(v,{});case"charts":return(0,s.jsx)(C,{});default:return(0,s.jsx)("div",{className:"text-gray-500",children:"Select an option from the tabs."})}})()}),(0,s.jsx)(r.ToastContainer,{})]})}},5526:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>c});var s=a(5155),l=a(2115),r=a(8637),n=a.n(r),o=a(5799),i=a(2105);let d=e=>{let{onUploadSuccess:t}=e,[a,r]=(0,l.useState)(null),[n,d]=(0,l.useState)(""),[c,u]=(0,l.useState)(!1),m=e=>{d(e.url),t(e.url),u(!1),o.oR.success("Image uploaded successfully!")},x=e=>{u(!1),o.oR.error("Image upload failed: "+e.message),console.error("Error uploading image:",e)};return(0,s.jsxs)("form",{onSubmit:e=>{if(e.preventDefault(),!a)return void o.oR.error("Please select a file first.");u(!0),i.QM.handler(m,x)(e)},className:"flex flex-col gap-4 bg-gray-50 p-4 rounded-xl border border-gray-200",children:[(0,s.jsxs)("label",{htmlFor:"eventImage",className:"text-sm font-semibold text-gray-700",children:["Upload Speaker Image ",(0,s.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,s.jsx)("input",{type:"file",id:"eventImage",name:"file",accept:"image/*",onChange:e=>{let t=e.target.files[0];t&&(r(URL.createObjectURL(t)),d(""))},disabled:c,className:"file:mr-3 file:py-2 file:px-4 file:rounded-md file:border-0 file:text-sm file:font-semibold file:bg-green-100 file:text-green-700 hover:file:bg-green-200 cursor-pointer"}),a&&(0,s.jsxs)("div",{className:"flex items-center gap-4 mt-2",children:[(0,s.jsx)("img",{src:a,alt:"Preview",className:"w-20 h-20 object-cover rounded-lg border"}),(0,s.jsx)("button",{type:"button",onClick:()=>{URL.revokeObjectURL(a),r(null),d(""),t("")},className:"text-sm text-red-500 hover:text-red-700 font-medium",children:"Remove"})]}),(0,s.jsx)("button",{type:"submit",disabled:!a||n||c,className:"px-4 py-2 rounded-lg text-white font-medium ".concat(c?"bg-green-400 cursor-wait":n?"bg-green-500 cursor-default":"bg-green-600 hover:bg-green-700"),children:c?"Uploading...":n?"Uploaded":"Upload"}),n&&(0,s.jsx)("input",{type:"hidden",name:"image_url",value:n})]})};d.propTypes={onUploadSuccess:n().func.isRequired};let c=d},6916:(e,t,a)=>{Promise.resolve().then(a.bind(a,3327))}},e=>{e.O(0,[797,711,647,726,311,766,874,811,105,313,441,964,358],()=>e(e.s=6916)),_N_E=e.O()}]);