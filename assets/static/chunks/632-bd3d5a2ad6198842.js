"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[632],{960:(e,t,a)=>{a.d(t,{A:()=>n});let n={src:"/assets/static/media/logo.21932253.png",height:779,width:779,blurDataURL:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAAICAMAAADz0U65AAAAbFBMVEX////SwcD20dPzwr7t9fGfurt5nKro7e3J29ymysbforXaxM6rvsT74tnuqaDQo7fU4uj4/Pz59/Ww2dPZ3NjWuLvtwcTZ29XZ6euLwcDGvt3gnKOVusP78eayxdOdqbTZt8+Mr7ntycW5vtCoSi2zAAAACXBIWXMAABcRAAAXEQHKJvM/AAAARUlEQVR4nBXLxxGAIAAAwUOyKJhztv8eHfe/QFlmGcCTy5TGmj2mazn8hIzhLfzcMqxC34V2NH3YTuEVqM6Yyv7NOmfhA3Z3AwyhtdhdAAAAAElFTkSuQmCC",blurWidth:8,blurHeight:8}},6004:(e,t,a)=>{a.a(e,async(e,n)=>{try{a.d(t,{A:()=>u});var s=a(5155),l=a(6874),r=a.n(l),c=a(6766),o=a(960),i=a(4239),d=a(5799);let e=await (0,i.VU)();function u(t){let{id:a,heading:n,date:l,location:u,img:m,status:g}=t;return(0,s.jsx)("div",{className:"w-full p-3",children:(0,s.jsxs)("div",{className:"bg-white rounded-2xl shadow-md hover:shadow-xl transition-all duration-300 overflow-hidden group h-full flex flex-col relative",children:[g&&(0,s.jsx)("span",{className:"absolute top-3 right-3 px-3 py-1 text-xs font-semibold rounded-full z-20\n              ".concat("Ended"===g&&"bg-red-600 text-white","\n              ").concat("Ongoing"===g&&"bg-green-600 text-white","\n              ").concat("Upcoming"===g&&"bg-blue-600 text-white","\n            "),children:g}),(0,s.jsx)(r(),{href:"/events/detail?id=".concat(a),className:"block",children:(0,s.jsx)("div",{className:"relative w-full h-52",children:(0,s.jsx)(c.default,{src:m||o.A,alt:n,fill:!0,className:"object-cover group-hover:scale-105 transition-transform duration-300\n                ".concat("Ended"===g?"opacity-70 grayscale":"","\n              ")})})}),(0,s.jsxs)("div",{className:"flex flex-col flex-grow justify-between p-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("h3",{className:"text-lg font-semibold leading-tight",children:n}),(0,s.jsx)("p",{className:"text-gray-500 text-sm mt-1",children:(null==l?void 0:l.year)!=="N/A"?"".concat(l.month,"/").concat(l.year):"Invalid Date"}),(0,s.jsx)("p",{className:"text-gray-700 font-medium mt-3",children:u})]}),e&&(0,s.jsx)("button",{onClick:()=>{(0,i.xF)("".concat(i.AS,"/api/attendances/").concat(a),"POST",{}).then(e=>d.oR.success(e.message)).catch(e=>d.oR.error(e.message))},className:"mt-4 w-full bg-blue-600 text-white py-2 rounded-lg    text-sm font-semibold hover:bg-blue-700 transition-colors",children:"Enroll"})]})]})})}n()}catch(e){n(e)}},1)},7185:(e,t,a)=>{a.a(e,async(e,n)=>{try{a.d(t,{default:()=>d});var s=a(5155),l=a(2115),r=a(6004),c=a(4239),o=a(8457),i=e([r]);r=(i.then?(await i)():i)[0];let u={all:"/api/events",upcoming:"/api/events/upcoming",ongoing:"/api/events/ongoing",ended:"/api/events/ended"};function d(){let[e,t]=(0,l.useState)([]),[a,n]=(0,l.useState)("all"),[i,d]=(0,l.useState)(!0),[m,g]=(0,l.useState)(""),h=(0,l.useRef)(0);return((0,l.useEffect)(()=>{let e=++h.current,n=!1;return(async()=>{d(!0),g("");try{let s;if("all"===a&&"function"==typeof c.kQ)s=await (0,c.kQ)();else{let e=u[a]||u.all;s=await (0,c.In)("".concat(c.AS).concat(e),"GET")}if(n||e!==h.current)return;let l=Array.isArray(s)?s:(null==s?void 0:s.events)||[];t(l)}catch(t){if(n||e!==h.current)return;g((null==t?void 0:t.message)||"Failed to load events")}finally{if(n||e!==h.current)return;d(!1)}})(),()=>{n=!0}},[a]),i)?(0,s.jsx)(o.A,{}):m?(0,s.jsx)("p",{className:"text-red-500 text-center p-4",children:m}):(0,s.jsxs)("div",{className:"w-full",children:[(0,s.jsx)("div",{className:"w-full p-4 bg-white border-b mb-6",children:(0,s.jsx)("div",{className:"flex flex-wrap gap-3",children:["all","upcoming","ongoing","ended"].map(e=>(0,s.jsx)("button",{onClick:()=>n(e),className:"px-4 py-2 rounded-full text-sm font-semibold transition\n                ".concat(a===e?"bg-blue-600 text-white":"bg-gray-200 text-gray-700 hover:bg-gray-300","\n              "),children:e.charAt(0).toUpperCase()+e.slice(1)},e))})}),(0,s.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6",children:[0===e.length&&(0,s.jsx)("p",{className:"w-full text-center text-gray-500 text-xl mt-6",children:"No events found."}),e.map(e=>{var t;let a=(null==e?void 0:e.start_time)?new Date(e.start_time):null,n=(null==e?void 0:e.end_time)?new Date(e.end_time):null,l=new Date,o=a?a.getFullYear():"N/A",i=a?a.getMonth()+1:"N/A",d="Upcoming";return n&&l>n?d="Ended":a&&n&&l>=a&&l<=n&&(d="Ongoing"),(0,s.jsx)(r.A,{id:e._id||e.id,heading:e.title,date:{year:o,month:i},location:(null==e||null==(t=e.location)?void 0:t.address)||"Unknown",img:(null==e?void 0:e.image)?"".concat(c.AS).concat(e.image):void 0,status:d},e._id||e.id)})]})]})}n()}catch(e){n(e)}})},7634:(e,t,a)=>{a.d(t,{A:()=>d});var n=a(5155),s=a(2115),l=a(8222),r=a(2105),c=a(8020),o=a(5799);let i=e=>{let{classroomId:t,onClose:a,socket:l,messages:r=[],currentUser:c}=e,[i,d]=(0,s.useState)(""),[u,m]=(0,s.useState)(!1),[g,h]=(0,s.useState)(null),x=(0,s.useRef)(null),p=(0,s.useRef)(null),f=(0,s.useRef)(null),b=(0,s.useRef)(0),v=(0,s.useCallback)(()=>{var e;null==(e=x.current)||e.scrollIntoView({behavior:"smooth"})},[]);(0,s.useEffect)(()=>{r.length>b.current&&setTimeout(v,100),b.current=r.length},[r,v]),(0,s.useEffect)(()=>{var e;null==(e=f.current)||e.focus(),setTimeout(v,100)},[v]);let y=(0,s.useCallback)(async()=>{let e=i.trim();if(!e&&!g)return void o.oR.warning("Please enter a message or select a file");if(!l)return void o.oR.error("Socket not connected");m(!0);try{var a;l.sendMessage(t,e),d(""),h(null),p.current&&(p.current.value=""),null==(a=f.current)||a.focus()}catch(e){console.error("Failed to send message:",e),o.oR.error("Failed to send message")}finally{m(!1)}},[i,g,l,t]),w=(0,s.useCallback)(e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),y())},[y]),j=(0,s.useCallback)(()=>{var e;null==(e=p.current)||e.click()},[]),k=(0,s.useCallback)(e=>{var t;let a=null==(t=e.target.files)?void 0:t[0];if(a){if(a.size>0xa00000){o.oR.error("File size must be less than 10MB"),e.target.value="";return}if(!["image/jpeg","image/png","image/gif","image/webp","application/pdf","text/plain","application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document"].includes(a.type)){o.oR.error("File type not supported"),e.target.value="";return}h(a),o.oR.success("File selected: ".concat(a.name))}},[]),C=(0,s.useCallback)(()=>{h(null),p.current&&(p.current.value="")},[]),A=(0,s.useCallback)(()=>{(!i.trim()&&!g||window.confirm("You have unsent content. Are you sure you want to close?"))&&a()},[i,g,a]);return(0,s.useEffect)(()=>{let e=e=>{"Escape"===e.key&&A()};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[A]),(0,n.jsx)("div",{className:"fixed inset-0 bg-black/60 z-50 flex items-center justify-center p-4",onClick:A,children:(0,n.jsxs)("div",{className:"bg-white w-full max-w-2xl rounded-2xl shadow-2xl flex flex-col h-[80vh] max-h-[600px]",onClick:e=>e.stopPropagation(),children:[(0,n.jsxs)("div",{className:"flex justify-between items-center p-4 border-b bg-gradient-to-r from-purple-600 to-blue-600 text-white rounded-t-2xl",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("h3",{className:"text-lg font-semibold",children:"Classroom Chat"}),(0,n.jsxs)("p",{className:"text-xs opacity-90",children:[r.length," messages"]})]}),(0,n.jsx)("button",{className:"px-4 py-2 rounded-lg bg-white/20 hover:bg-white/30 transition-all font-medium",onClick:A,children:"✕ Close"})]}),(0,n.jsx)("div",{className:"flex-1 overflow-y-auto p-4 space-y-3 bg-gray-50",children:0===r.length?(0,n.jsxs)("div",{className:"flex flex-col items-center justify-center h-full text-gray-400",children:[(0,n.jsx)("svg",{className:"w-16 h-16 mb-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,n.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"})}),(0,n.jsx)("p",{className:"text-sm",children:"No messages yet. Start the conversation!"})]}):(0,n.jsxs)(n.Fragment,{children:[r.map((e,t)=>{let a=c&&e.nickname===c.nickname,s=0===t||r[t-1].nickname!==e.nickname;return(0,n.jsx)("div",{className:"flex ".concat(a?"justify-end":"justify-start"),children:(0,n.jsxs)("div",{className:"max-w-[70%] ".concat(a?"items-end":"items-start"," flex flex-col"),children:[s&&(0,n.jsx)("p",{className:"text-xs font-semibold mb-1 ".concat(a?"text-blue-600":"text-gray-600"),children:a?"You":e.nickname||"Anonymous"}),(0,n.jsx)("div",{className:"rounded-2xl px-4 py-2 shadow-sm ".concat(a?"bg-blue-600 text-white rounded-tr-sm":"bg-white text-gray-800 rounded-tl-sm border border-gray-200"),children:(0,n.jsx)("p",{className:"text-sm whitespace-pre-wrap break-words",children:e.message})}),(0,n.jsx)("p",{className:"text-[10px] text-gray-400 mt-1 px-1",children:(e=>{if(!e)return"Just now";let t=new Date(e);if(isNaN(t.getTime()))return"Just now";let a=Math.floor((new Date-t)/6e4);return a<1?"Just now":a<60?"".concat(a,"m ago"):a<1440?"".concat(Math.floor(a/60),"h ago"):t.toLocaleDateString("en-US",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})})(e.createdAt||e.at||e.timestamp)})]})},"".concat(e.timestamp||t,"-").concat(e.message))}),(0,n.jsx)("div",{ref:x})]})}),g&&(0,n.jsxs)("div",{className:"px-4 py-2 bg-blue-50 border-t border-blue-100 flex items-center justify-between",children:[(0,n.jsxs)("div",{className:"flex items-center gap-2",children:[(0,n.jsx)("span",{className:"text-2xl",children:"\uD83D\uDCCE"}),(0,n.jsxs)("div",{children:[(0,n.jsx)("p",{className:"text-sm font-medium text-gray-800",children:g.name}),(0,n.jsxs)("p",{className:"text-xs text-gray-500",children:[(g.size/1024).toFixed(1)," KB"]})]})]}),(0,n.jsx)("button",{onClick:C,className:"text-red-600 hover:text-red-700 font-medium text-sm",children:"Remove"})]}),(0,n.jsxs)("div",{className:"p-4 border-t bg-white rounded-b-2xl",children:[(0,n.jsxs)("div",{className:"flex gap-2",children:[(0,n.jsx)("textarea",{ref:f,className:"flex-1 border border-gray-300 rounded-lg px-4 py-2 resize-none focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Type your message...",value:i,onChange:e=>d(e.target.value),onKeyDown:w,rows:1,disabled:u}),(0,n.jsx)("button",{onClick:j,disabled:u,className:"px-4 py-2 border border-gray-300 rounded-lg bg-gray-50 hover:bg-gray-100 transition-all disabled:opacity-50 disabled:cursor-not-allowed",title:"Attach file",children:(0,n.jsx)("span",{className:"text-xl",children:"\uD83D\uDCCE"})}),(0,n.jsx)("input",{type:"file",ref:p,onChange:k,className:"hidden",accept:"image/*,.pdf,.doc,.docx,.txt"}),(0,n.jsx)("button",{className:"px-6 py-2 rounded-lg font-medium transition-all ".concat(!u&&(i.trim()||g)?"bg-blue-600 text-white hover:bg-blue-700 shadow-md hover:shadow-lg":"bg-gray-300 text-gray-500 cursor-not-allowed"),onClick:y,disabled:u||!i.trim()&&!g,children:u?"Sending...":"Send"})]}),(0,n.jsx)("p",{className:"text-xs text-gray-400 mt-2 text-center",children:"Press Enter to send, Shift+Enter for new line"})]})]})})},d=()=>{let e=(0,l.F)(),[t,a]=(0,s.useState)([]),[o,d]=(0,s.useState)(!0),[u,m]=(0,s.useState)(null),[g,h]=(0,s.useState)(null),[x,p]=(0,s.useState)({}),f=(0,s.useRef)(null),b=(0,s.useCallback)(e=>{console.log("⚡ UI Received Message:",e);let t=e.classroom_id||e.classroomId||e._id;a(a=>a.map(a=>String(a._id)===String(t)?{...a,discussion:[...a.discussion||[],{nickname:e.nickname||"User",message:e.message,createdAt:e.createdAt||new Date().toISOString(),timestamp:Date.now()}]}:a))},[]),v=(0,s.useCallback)((e,t)=>{"started"===e?toast.info("Attendance Started for: ".concat(t.classroom_name)):"punchIn"===e?t.success?toast.success("Punch In Successful!"):toast.error(t.message):"punchOut"===e&&(t.success?toast.success("Punch Out Successful!"):toast.error(t.message))},[]);(0,s.useEffect)(()=>{(async()=>{try{d(!0);let[t,n]=await Promise.all([(0,r.VU)(),(0,r.pn)()]);m(t);let s=(null==n?void 0:n.length)?n:(null==n?void 0:n.classrooms)||[];if(a(s),e&&s.length>0){console.log("\uD83D\uDD17 Wiring up Socket Context..."),e.setCallback("newMessageCallback",b),e.setCallback("attendanceStartedCallback",e=>v("started",e)),e.setCallback("punchInCallback",e=>v("punchIn",e)),e.setCallback("punchOutCallback",e=>v("punchOut",e));let t=s.map(e=>e._id);"function"==typeof e.joinClassRoom?e.joinClassRoom(t):e.socket&&e.socket.emit("join_classroom",t)}}catch(e){console.error("Init Error:",e),toast.error("Failed to load classrooms")}finally{d(!1)}})()},[e,b,v]),(0,s.useEffect)(()=>{if(0!==Object.keys(x).length)return f.current=setInterval(()=>{let t=Date.now();p(a=>{let n={...a},s=!1;return Object.entries(a).forEach(a=>{let[l,r]=a;t>=r&&((null==e?void 0:e.stopAttendance)&&e.stopAttendance(l),delete n[l],s=!0,toast.info("Attendance ended automatically."))}),s?n:a})},1e3),()=>clearInterval(f.current)},[x,e]);let y=(t,a)=>e?navigator.geolocation?void navigator.geolocation.getCurrentPosition(n=>{let s={classroom_id:a,location:{lat:n.coords.latitude,long:n.coords.longitude}};"punchIn"===t&&e.punchIn?e.punchIn(s):"punchOut"===t&&e.punchOut?e.punchOut(s):e.socket.emit("punchIn"===t?"punch_in":"punch_out",s)},e=>{console.error(e),toast.error("Location access denied.")}):toast.error("Geolocation not supported"):toast.error("Socket not connected");return o||!u?(0,n.jsx)(c.A,{}):(0,n.jsxs)("div",{className:"min-h-screen bg-gray-100 px-6 py-10",children:[(0,n.jsx)("h2",{className:"text-4xl font-extrabold text-gray-800 text-center mb-10",children:"Classrooms"}),0===t.length?(0,n.jsx)("div",{className:"text-center text-gray-600",children:"No classrooms found."}):(0,n.jsx)("div",{className:"grid grid-cols-1 sm:grid-cols-2 xl:grid-cols-3 gap-8",children:t.map(t=>{var a;let s=x[t._id],l=!!s,r=l?Math.max(0,Math.ceil((s-Date.now())/1e3)):0;return(0,n.jsxs)("div",{className:"relative bg-white rounded-2xl shadow-lg p-6 border ".concat(l?"border-green-500 ring-1 ring-green-500":"border-gray-200"),children:[(0,n.jsx)("h3",{className:"text-xl font-bold text-gray-900 text-center mb-4",children:t.name}),(0,n.jsxs)("div",{className:"flex flex-col gap-3",children:[(0,n.jsxs)("button",{onClick:()=>h(t._id),className:"w-full py-2 bg-purple-600 text-white rounded hover:bg-purple-700",children:["\uD83D\uDCAC Chat (",(null==(a=t.discussion)?void 0:a.length)||0,")"]}),"Teacher"===u.role&&(0,n.jsx)("button",{onClick:()=>(t=>{if(!e)return toast.error("Socket not connected");e.startAttendance?e.startAttendance(t,10):e.socket.emit("start_attendance",{classroomId:t,duration:10}),p(e=>({...e,[t]:Date.now()+6e5})),toast.success("Attendance started (10m)")})(t._id),disabled:l,className:"w-full py-2 text-white rounded ".concat(l?"bg-gray-400":"bg-blue-600 hover:bg-blue-700"),children:l?"Ends in: ".concat(Math.floor(r/60),"m ").concat(r%60,"s"):"Start Attendance"}),(0,n.jsxs)("div",{className:"flex gap-2",children:[(0,n.jsx)("button",{onClick:()=>y("punchIn",t._id),className:"flex-1 py-2 bg-green-600 text-white rounded hover:bg-green-700",children:"Punch In"}),(0,n.jsx)("button",{onClick:()=>y("punchOut",t._id),className:"flex-1 py-2 bg-red-600 text-white rounded hover:bg-red-700",children:"Punch Out"})]})]})]},t._id)})}),g&&(0,n.jsx)(i,{classroomId:g,socket:e,onClose:()=>h(null),messages:(()=>{var e;return g&&(null==(e=t.find(e=>String(e._id)===String(g)))?void 0:e.discussion)||[]})(),currentUser:u})]})}},8020:(e,t,a)=>{a.d(t,{A:()=>r});var n=a(5155),s=a(6766),l=a(8274);function r(){return(0,n.jsxs)("div",{className:"fixed inset-0 z-50 flex flex-col items-center justify-center bg-white",children:[(0,n.jsx)(l.P.div,{initial:{scale:.8,opacity:.5},animate:{scale:[.9,1.1,.9],opacity:[.5,1,.5]},transition:{duration:2,repeat:1/0,ease:"easeInOut"},className:"absolute w-64 h-64 rounded-full bg-gradient-to-tr from-blue-400 to-purple-500 blur-3xl opacity-30"}),(0,n.jsx)(l.P.div,{initial:{scale:.8,opacity:0},animate:{scale:1,opacity:1},transition:{duration:.8,ease:"easeOut"},children:(0,n.jsx)(s.default,{src:"/loader.png",alt:"Loading...",width:200,height:200,priority:!0,className:"drop-shadow-lg"})}),(0,n.jsx)(l.P.p,{initial:{opacity:0},animate:{opacity:[0,1,0]},transition:{duration:1.5,repeat:1/0},className:"mt-6 text-lg font-semibold text-gray-600",children:"Loading..."})]})}},8222:(e,t,a)=>{a.d(t,{F:()=>i,SocketProvider:()=>o});var n=a(5155),s=a(2115),l=a(2105),r=a(5799);let c=(0,s.createContext)(null),o=e=>{let{children:t}=e,a=(0,s.useRef)(null),o=(0,s.useRef)({newMessageCallback:()=>{},connectionCallback:()=>{},successCallback:()=>{},errorCallback:()=>{},attendanceStartedCallback:()=>{},attendanceStoppedCallback:()=>{},punchInCallback:()=>{},punchOutCallback:()=>{}});return a.current||(a.current=new l.s_({newMessageCallback:e=>{r.oR.info(e.message),o.current.newMessageCallback(e)},connectionCallback:e=>{r.oR.info(e.message),o.current.connectionCallback(e)},successCallback:e=>{r.oR.info(e.message),o.current.successCallback(e)},errorCallback:e=>{r.oR.error(e.message),o.current.errorCallback(e)},attendanceStartedCallback:e=>{r.oR.info(e.message),o.current.attendanceStartedCallback(e)},attendanceStoppedCallback:e=>{r.oR.info(e.message),o.current.attendanceStoppedCallback(e)},punchInCallback:e=>{r.oR.info(e.message),o.current.punchInCallback(e)},punchOutCallback:e=>{r.oR.info(e.message),o.current.punchOutCallback(e)}}),a.current.setCallback=(e,t)=>{o.current[e]&&(o.current[e]=t)}),(0,n.jsx)(c.Provider,{value:a.current,children:t})},i=()=>(0,s.useContext)(c)},8457:(e,t,a)=>{a.d(t,{A:()=>c});var n=a(5155),s=a(2115),l=a(5695),r=a(8020);function c(e){let{children:t}=e,[a,c]=(0,s.useState)(!1),o=(0,l.usePathname)();return(0,s.useEffect)(()=>{c(!0);let e=setTimeout(()=>{c(!1)},800);return()=>clearTimeout(e)},[o]),(0,n.jsxs)(n.Fragment,{children:[a&&(0,n.jsx)(r.A,{}),t]})}}}]);