"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[313],{960:(e,t,n)=>{n.d(t,{A:()=>a});let a={src:"/assets/static/media/logo.21932253.png",height:779,width:779,blurDataURL:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAAICAMAAADz0U65AAAAbFBMVEX////SwcD20dPzwr7t9fGfurt5nKro7e3J29ymysbforXaxM6rvsT74tnuqaDQo7fU4uj4/Pz59/Ww2dPZ3NjWuLvtwcTZ29XZ6euLwcDGvt3gnKOVusP78eayxdOdqbTZt8+Mr7ntycW5vtCoSi2zAAAACXBIWXMAABcRAAAXEQHKJvM/AAAARUlEQVR4nBXLxxGAIAAAwUOyKJhztv8eHfe/QFlmGcCTy5TGmj2mazn8hIzhLfzcMqxC34V2NH3YTuEVqM6Yyv7NOmfhA3Z3AwyhtdhdAAAAAElFTkSuQmCC",blurWidth:8,blurHeight:8}},2838:(e,t,n)=>{n.d(t,{default:()=>p});var a=n(5155),s=n(2115),l=n(4239),r=n(960),c=n(6766),o=n(6874),i=n.n(o),d=n(5799);function u(e){let{id:t,heading:n,date:o,location:u,img:m,status:g}=e,[x,h]=(0,s.useState)(!1);return(0,s.useEffect)(()=>{(0,l.VU)().then(e=>h(e))},[]),(0,a.jsx)("div",{className:"w-full p-3",children:(0,a.jsxs)("div",{className:"bg-white rounded-2xl shadow-md hover:shadow-xl transition-all duration-300 overflow-hidden group h-full flex flex-col relative",children:[g&&(0,a.jsx)("span",{className:"absolute top-3 right-3 px-3 py-1 text-xs font-semibold rounded-full z-20\n              ".concat("Ended"===g&&"bg-red-600 text-white","\n              ").concat("Ongoing"===g&&"bg-green-600 text-white","\n              ").concat("Upcoming"===g&&"bg-blue-600 text-white","\n            "),children:g}),(0,a.jsx)(i(),{href:"/events/detail?id=".concat(t),className:"block",children:(0,a.jsx)("div",{className:"relative w-full min-h-[350px]",children:(0,a.jsx)(c.default,{src:m||r.A,alt:n,fill:!0,className:"object-cover group-hover:scale-105 transition-transform duration-300\n                ".concat("Ended"===g?"opacity-70 grayscale":"","\n              ")})})}),(0,a.jsxs)("div",{className:"flex flex-col flex-grow justify-between p-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"text-lg font-semibold leading-tight",children:n}),(0,a.jsx)("p",{className:"text-gray-500 text-sm mt-1",children:(null==o?void 0:o.year)!=="N/A"?"".concat(o.month,"/").concat(o.year):"Invalid Date"}),(0,a.jsx)("p",{className:"text-gray-700 font-medium mt-3",children:u})]}),x&&(0,a.jsx)("button",{onClick:()=>{(0,l.xF)("".concat(l.AS,"/api/attendances/").concat(t),"POST",{}).then(e=>d.oR.success(e.message)).catch(e=>d.oR.error(e.message))},className:"mt-4 w-full bg-blue-600 text-white py-2 rounded-lg    text-sm font-semibold hover:bg-blue-700 transition-colors",children:"Enroll"})]})]})})}var m=n(5695),g=n(8020);function x(e){let{children:t}=e,[n,l]=(0,s.useState)(!1),r=(0,m.usePathname)();return(0,s.useEffect)(()=>{l(!0);let e=setTimeout(()=>{l(!1)},800);return()=>clearTimeout(e)},[r]),(0,a.jsxs)(a.Fragment,{children:[n&&(0,a.jsx)(g.A,{}),t]})}let h={all:"/api/events",upcoming:"/api/events/upcoming",ongoing:"/api/events/ongoing",ended:"/api/events/ended"};function p(){let[e,t]=(0,s.useState)([]),[n,r]=(0,s.useState)("all"),[c,o]=(0,s.useState)(!0),[i,d]=(0,s.useState)(""),m=(0,s.useRef)(0);return((0,s.useEffect)(()=>{let e=++m.current,a=!1;return(async()=>{o(!0),d("");try{let s;if("all"===n&&"function"==typeof l.kQ)s=await (0,l.kQ)();else{let e=h[n]||h.all;s=await (0,l.In)("".concat(l.AS).concat(e),"GET")}if(a||e!==m.current)return;let r=Array.isArray(s)?s:(null==s?void 0:s.events)||[];t(r)}catch(t){if(a||e!==m.current)return;d((null==t?void 0:t.message)||"Failed to load events")}finally{if(a||e!==m.current)return;o(!1)}})(),()=>{a=!0}},[n]),c)?(0,a.jsx)(x,{}):i?(0,a.jsx)("p",{className:"text-red-500 text-center p-4",children:i}):(0,a.jsxs)("div",{className:"w-full",children:[(0,a.jsx)("div",{className:"w-full p-4 bg-white border-b mb-6",children:(0,a.jsx)("div",{className:"flex flex-wrap gap-3",children:["all","upcoming","ongoing","ended"].map(e=>(0,a.jsx)("button",{onClick:()=>r(e),className:"px-4 py-2 rounded-full text-sm font-semibold transition\n                ".concat(n===e?"bg-blue-600 text-white":"bg-gray-200 text-gray-700 hover:bg-gray-300","\n              "),children:e.charAt(0).toUpperCase()+e.slice(1)},e))})}),(0,a.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6",children:[0===e.length&&(0,a.jsx)("p",{className:"w-full text-center text-gray-500 text-xl mt-6",children:"No events found."}),e.map(e=>{var t;let n=(null==e?void 0:e.start_time)?new Date(e.start_time):null,s=(null==e?void 0:e.end_time)?new Date(e.end_time):null,r=new Date,c=n?n.getFullYear():"N/A",o=n?n.getMonth()+1:"N/A",i="Upcoming";return s&&r>s?i="Ended":n&&s&&r>=n&&r<=s&&(i="Ongoing"),(0,a.jsx)(u,{id:e._id||e.id,heading:e.title,date:{year:c,month:o},location:(null==e||null==(t=e.location)?void 0:t.address)||"Unknown",img:(null==e?void 0:e.image)?"".concat(l.AS).concat(e.image):void 0,status:i},e._id||e.id)})]})]})}},4239:(e,t,n)=>{n.d(t,{A$:()=>a.A$,AS:()=>a.AS,DY:()=>a.DY,In:()=>a.In,Pq:()=>a.Pq,VU:()=>a.VU,Yq:()=>a.Yq,bB:()=>a.bB,eg:()=>a.eg,iD:()=>a.iD,kQ:()=>a.kQ,lh:()=>a.lh,lo:()=>a.lo,qM:()=>a.qM,tq:()=>a.tq,xF:()=>a.xF,xw:()=>a.xw,zz:()=>a.zz});var a=n(2105)},7634:(e,t,n)=>{n.d(t,{A:()=>d});var a=n(5155),s=n(2115),l=n(5799),r=n(8222),c=n(2105),o=n(8020);let i=e=>{let{classroomId:t,onClose:n,socket:r,messages:c=[],currentUser:o}=e,[i,d]=(0,s.useState)(""),[u,m]=(0,s.useState)(!1),[g,x]=(0,s.useState)(null),h=(0,s.useRef)(null),p=(0,s.useRef)(null),f=(0,s.useRef)(null),b=(0,s.useRef)(0),v=(0,s.useCallback)(()=>{var e;null==(e=h.current)||e.scrollIntoView({behavior:"smooth"})},[]);(0,s.useEffect)(()=>{c.length>b.current&&setTimeout(v,100),b.current=c.length},[c,v]),(0,s.useEffect)(()=>{var e;null==(e=f.current)||e.focus(),setTimeout(v,100)},[v]);let w=(0,s.useCallback)(async()=>{let e=i.trim();if(!e&&!g)return void l.oR.warning("Please enter a message or select a file");if(!r)return void l.oR.error("Socket not connected");m(!0);try{var n;r.sendMessage(t,e),d(""),x(null),p.current&&(p.current.value=""),null==(n=f.current)||n.focus()}catch(e){console.error("Failed to send message:",e),l.oR.error("Failed to send message")}finally{m(!1)}},[i,g,r,t]),y=(0,s.useCallback)(e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),w())},[w]),j=(0,s.useCallback)(()=>{var e;null==(e=p.current)||e.click()},[]),k=(0,s.useCallback)(e=>{var t;let n=null==(t=e.target.files)?void 0:t[0];if(n){if(n.size>0xa00000){l.oR.error("File size must be less than 10MB"),e.target.value="";return}if(!["image/jpeg","image/png","image/gif","image/webp","application/pdf","text/plain","application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document"].includes(n.type)){l.oR.error("File type not supported"),e.target.value="";return}x(n),l.oR.success("File selected: ".concat(n.name))}},[]),C=(0,s.useCallback)(()=>{x(null),p.current&&(p.current.value="")},[]),A=(0,s.useCallback)(()=>{(!i.trim()&&!g||window.confirm("You have unsent content. Are you sure you want to close?"))&&n()},[i,g,n]);return(0,s.useEffect)(()=>{let e=e=>{"Escape"===e.key&&A()};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[A]),(0,a.jsx)("div",{className:"fixed inset-0 bg-black/60 z-50 flex items-center justify-center p-4",onClick:A,children:(0,a.jsxs)("div",{className:"bg-white w-full max-w-2xl rounded-2xl shadow-2xl flex flex-col h-[80vh] max-h-[600px]",onClick:e=>e.stopPropagation(),children:[(0,a.jsxs)("div",{className:"flex justify-between items-center p-4 border-b bg-gradient-to-r from-purple-600 to-blue-600 text-white rounded-t-2xl",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"text-lg font-semibold",children:"Classroom Chat"}),(0,a.jsxs)("p",{className:"text-xs opacity-90",children:[c.length," messages"]})]}),(0,a.jsx)("button",{className:"px-4 py-2 rounded-lg bg-white/20 hover:bg-white/30 transition-all font-medium",onClick:A,children:"✕ Close"})]}),(0,a.jsx)("div",{className:"flex-1 overflow-y-auto p-4 space-y-3 bg-gray-50",children:0===c.length?(0,a.jsxs)("div",{className:"flex flex-col items-center justify-center h-full text-gray-400",children:[(0,a.jsx)("svg",{className:"w-16 h-16 mb-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"})}),(0,a.jsx)("p",{className:"text-sm",children:"No messages yet. Start the conversation!"})]}):(0,a.jsxs)(a.Fragment,{children:[c.map((e,t)=>{let n=o&&e.nickname===o.nickname,s=0===t||c[t-1].nickname!==e.nickname;return(0,a.jsx)("div",{className:"flex ".concat(n?"justify-end":"justify-start"),children:(0,a.jsxs)("div",{className:"max-w-[70%] ".concat(n?"items-end":"items-start"," flex flex-col"),children:[s&&(0,a.jsx)("p",{className:"text-xs font-semibold mb-1 ".concat(n?"text-blue-600":"text-gray-600"),children:n?"You":e.nickname||"Anonymous"}),(0,a.jsx)("div",{className:"rounded-2xl px-4 py-2 shadow-sm ".concat(n?"bg-blue-600 text-white rounded-tr-sm":"bg-white text-gray-800 rounded-tl-sm border border-gray-200"),children:(0,a.jsx)("p",{className:"text-sm whitespace-pre-wrap break-words",children:e.message})}),(0,a.jsx)("p",{className:"text-[10px] text-gray-400 mt-1 px-1",children:(e=>{if(!e)return"Just now";let t=new Date(e);if(isNaN(t.getTime()))return"Just now";let n=Math.floor((new Date-t)/6e4);return n<1?"Just now":n<60?"".concat(n,"m ago"):n<1440?"".concat(Math.floor(n/60),"h ago"):t.toLocaleDateString("en-US",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})})(e.createdAt||e.at||e.timestamp)})]})},"".concat(e.timestamp||t,"-").concat(e.message))}),(0,a.jsx)("div",{ref:h})]})}),g&&(0,a.jsxs)("div",{className:"px-4 py-2 bg-blue-50 border-t border-blue-100 flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("span",{className:"text-2xl",children:"\uD83D\uDCCE"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm font-medium text-gray-800",children:g.name}),(0,a.jsxs)("p",{className:"text-xs text-gray-500",children:[(g.size/1024).toFixed(1)," KB"]})]})]}),(0,a.jsx)("button",{onClick:C,className:"text-red-600 hover:text-red-700 font-medium text-sm",children:"Remove"})]}),(0,a.jsxs)("div",{className:"p-4 border-t bg-white rounded-b-2xl",children:[(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)("textarea",{ref:f,className:"flex-1 border border-gray-300 rounded-lg px-4 py-2 resize-none focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Type your message...",value:i,onChange:e=>d(e.target.value),onKeyDown:y,rows:1,disabled:u}),(0,a.jsx)("button",{onClick:j,disabled:u,className:"px-4 py-2 border border-gray-300 rounded-lg bg-gray-50 hover:bg-gray-100 transition-all disabled:opacity-50 disabled:cursor-not-allowed",title:"Attach file",children:(0,a.jsx)("span",{className:"text-xl",children:"\uD83D\uDCCE"})}),(0,a.jsx)("input",{type:"file",ref:p,onChange:k,className:"hidden",accept:"image/*,.pdf,.doc,.docx,.txt"}),(0,a.jsx)("button",{className:"px-6 py-2 rounded-lg font-medium transition-all ".concat(!u&&(i.trim()||g)?"bg-blue-600 text-white hover:bg-blue-700 shadow-md hover:shadow-lg":"bg-gray-300 text-gray-500 cursor-not-allowed"),onClick:w,disabled:u||!i.trim()&&!g,children:u?"Sending...":"Send"})]}),(0,a.jsx)("p",{className:"text-xs text-gray-400 mt-2 text-center",children:"Press Enter to send, Shift+Enter for new line"})]})]})})},d=()=>{let e=(0,r.F)(),[t,n]=(0,s.useState)([]),[d,u]=(0,s.useState)(!0),[m,g]=(0,s.useState)(null),[x,h]=(0,s.useState)(null),[p,f]=(0,s.useState)({}),b=(0,s.useRef)(null);(0,s.useEffect)(()=>{if(!e)return;let t=e.socket||e;t?!1===t.connected&&(console.log("\uD83D\uDD0C Socket is disconnected. Forcing connection now..."),t.connect?t.connect():t.open&&t.open()):console.warn("⚠️ Socket wrapper exists, but raw IO client is missing.")},[e]);let v=(0,s.useCallback)(e=>{console.log("⚡ UI Received Message:",e);let t=e.classroom_id||e.classroomId||e._id;n(n=>n.map(n=>String(n._id)===String(t)?{...n,discussion:[...n.discussion||[],{nickname:e.nickname||"User",message:e.message,createdAt:e.createdAt||new Date().toISOString(),timestamp:Date.now()}]}:n))},[]),w=(0,s.useCallback)((e,t)=>{"started"===e?l.oR.info("Attendance Started for: ".concat(t.classroom_name)):"punchIn"===e?t.success?l.oR.success("Punch In Successful!"):l.oR.error(t.message):"punchOut"===e&&(t.success?l.oR.success("Punch Out Successful!"):l.oR.error(t.message))},[]),y=async()=>{try{u(!0);let[t,a]=await Promise.all([(0,c.VU)(),(0,c.pn)()]);g(t);let s=(null==a?void 0:a.length)?a:(null==a?void 0:a.classrooms)||[];if(n(s),e&&s.length>0){console.log("\uD83D\uDD17 Wiring up Socket Context..."),e.setCallback("newMessageCallback",v),e.setCallback("attendanceStartedCallback",e=>w("started",e)),e.setCallback("punchInCallback",e=>w("punchIn",e)),e.setCallback("punchOutCallback",e=>w("punchOut",e));let t=s.map(e=>e._id);"function"==typeof e.joinClassRoom?e.joinClassRoom(t):e.socket&&e.socket.emit("join_classroom",t)}}catch(e){console.error("Init Error:",e),l.oR.error("Failed to load classrooms")}finally{setTimeout(()=>{u(!1)},2e3)}};(0,s.useEffect)(()=>{y()},[e,v,w]),(0,s.useEffect)(()=>{if(0!==Object.keys(p).length)return b.current=setInterval(()=>{let t=Date.now();f(n=>{let a={...n},s=!1;return Object.entries(n).forEach(n=>{let[r,c]=n;t>=c&&((null==e?void 0:e.stopAttendance)&&e.stopAttendance(r),delete a[r],s=!0,l.oR.info("Attendance ended automatically."))}),s?a:n})},1e3),()=>clearInterval(b.current)},[p,e]);let j=(t,n)=>e?navigator.geolocation?void navigator.geolocation.getCurrentPosition(a=>{let s={classroom_id:n,location:{lat:a.coords.latitude,long:a.coords.longitude}};"punchIn"===t&&e.punchIn?e.punchIn(s):"punchOut"===t&&e.punchOut?e.punchOut(s):e.socket.emit("punchIn"===t?"punch_in":"punch_out",s)},e=>{console.error(e),l.oR.error("Location access denied.")}):l.oR.error("Geolocation not supported"):l.oR.error("Socket not connected");return d||!m?(0,a.jsx)(o.A,{}):(0,a.jsxs)("div",{className:"min-h-screen bg-gray-100 px-6 py-10",children:[(0,a.jsx)("h2",{className:"text-4xl font-extrabold text-gray-800 text-center mb-10",children:"Classrooms"}),0===t.length?(0,a.jsx)("div",{className:"text-center text-gray-600",children:"No classrooms found."}):(0,a.jsx)("div",{className:"grid grid-cols-1 sm:grid-cols-2 xl:grid-cols-3 gap-8",children:t.map(t=>{var n;let s=p[t._id],r=!!s,c=r?Math.max(0,Math.ceil((s-Date.now())/1e3)):0;return(0,a.jsxs)("div",{className:"relative bg-white rounded-2xl shadow-lg p-6 border ".concat(r?"border-green-500 ring-1 ring-green-500":"border-gray-200"),children:[(0,a.jsx)("h3",{className:"text-xl font-bold text-gray-900 text-center mb-4",children:t.name}),(0,a.jsxs)("div",{className:"flex flex-col gap-3",children:[(0,a.jsxs)("button",{onClick:()=>h(t._id),className:"w-full py-2 bg-purple-600 text-white rounded hover:bg-purple-700",children:["\uD83D\uDCAC Chat (",(null==(n=t.discussion)?void 0:n.length)||0,")"]}),"Teacher"===m.role&&(0,a.jsx)("button",{onClick:()=>((t,n)=>{if(!e)return l.oR.error("Socket not connected");e.startAttendance?e.startAttendance(t,n,10):e.socket.emit("start_attendance",{classroomId:t,classroom_name:n,duration:10}),f(e=>({...e,[t]:Date.now()+6e5})),l.oR.success("Attendance started (10m)")})(t._id,t.name),disabled:r,className:"w-full py-2 text-white rounded ".concat(r?"bg-gray-400":"bg-blue-600 hover:bg-blue-700"),children:r?"Ends in: ".concat(Math.floor(c/60),"m ").concat(c%60,"s"):"Start Attendance"}),"Student"===m.role&&(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)("button",{onClick:()=>j("punchIn",t._id),className:"flex-1 py-2 bg-green-600 text-white rounded hover:bg-green-700",children:"Punch In"}),(0,a.jsx)("button",{onClick:()=>j("punchOut",t._id),className:"flex-1 py-2 bg-red-600 text-white rounded hover:bg-red-700",children:"Punch Out"})]})]})]},t._id)})}),x&&(0,a.jsx)(i,{classroomId:x,socket:e,onClose:()=>h(null),messages:(()=>{var e;return x&&(null==(e=t.find(e=>String(e._id)===String(x)))?void 0:e.discussion)||[]})(),currentUser:m})]})}},8020:(e,t,n)=>{n.d(t,{A:()=>r});var a=n(5155),s=n(6766),l=n(8274);function r(){return(0,a.jsxs)("div",{className:"fixed inset-0 z-50 flex flex-col items-center justify-center bg-white",children:[(0,a.jsx)(l.P.div,{initial:{scale:.8,opacity:.5},animate:{scale:[.9,1.1,.9],opacity:[.5,1,.5]},transition:{duration:2,repeat:1/0,ease:"easeInOut"},className:"absolute w-64 h-64 rounded-full bg-gradient-to-tr from-blue-400 to-purple-500 blur-3xl opacity-30"}),(0,a.jsx)(l.P.div,{initial:{scale:.8,opacity:0},animate:{scale:1,opacity:1},transition:{duration:.8,ease:"easeOut"},children:(0,a.jsx)(s.default,{src:"/loader.png",alt:"Loading...",width:200,height:200,priority:!0,className:"drop-shadow-lg"})}),(0,a.jsx)(l.P.p,{initial:{opacity:0},animate:{opacity:[0,1,0]},transition:{duration:1.5,repeat:1/0},className:"mt-6 text-lg font-semibold text-gray-600",children:"Loading..."})]})}},8222:(e,t,n)=>{n.d(t,{F:()=>i,SocketProvider:()=>o});var a=n(5155),s=n(2115),l=n(2105),r=n(5799);let c=(0,s.createContext)(null),o=e=>{let{children:t}=e,n=(0,s.useRef)(null),o=(0,s.useRef)({newMessageCallback:()=>{},connectionCallback:()=>{},successCallback:()=>{},errorCallback:()=>{},attendanceStartedCallback:()=>{},attendanceStoppedCallback:()=>{},punchInCallback:()=>{},punchOutCallback:()=>{}});return n.current||(n.current=new l.s_({newMessageCallback:e=>{r.oR.info(e.message),o.current.newMessageCallback(e)},connectionCallback:e=>{r.oR.info(e.message),o.current.connectionCallback(e)},successCallback:e=>{r.oR.info(e.message),o.current.successCallback(e)},errorCallback:e=>{r.oR.error(e.message),o.current.errorCallback(e)},attendanceStartedCallback:e=>{r.oR.info(e.message),o.current.attendanceStartedCallback(e)},attendanceStoppedCallback:e=>{r.oR.info(e.message),o.current.attendanceStoppedCallback(e)},punchInCallback:e=>{r.oR.info(e.message),o.current.punchInCallback(e)},punchOutCallback:e=>{r.oR.info(e.message),o.current.punchOutCallback(e)}}),n.current.setCallback=(e,t)=>{o.current[e]&&(o.current[e]=t)}),(0,a.jsx)(c.Provider,{value:n.current,children:t})},i=()=>(0,s.useContext)(c)}}]);